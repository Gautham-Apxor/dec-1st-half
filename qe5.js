!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],e):(t=t||self)["apxor-qe"]=e(t.Apxor)}(this,(function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function r(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?e(Object(i),!0).forEach((function(e){u(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function i(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,i(n.key),n)}}function s(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e,r){return(e=i(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var f=function(t){return void 0!==t&&!function(t){return null===t}(t)},d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function v(t,e){return Array.from(e).map((function(e,r){return String.fromCharCode(e^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,r))})).join("")}var h=function(t,e){return v(t,e=function(t){var e,r,i,n,a,o,s=0,u=[];if(!t)return t;t+="";do{e=(o=d.indexOf(t.charAt(s++))<<18|d.indexOf(t.charAt(s++))<<12|(n=d.indexOf(t.charAt(s++)))<<6|(a=d.indexOf(t.charAt(s++))))>>16&255,r=o>>8&255,i=255&o,u.push(e),64!==n&&(u.push(r),64!==a&&u.push(i))}while(s<t.length);return u}(e))},p=function(t){switch(t){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE"}return"Unknown"},g=function(t){return t.toUpperCase()},_=function(t,e,r){switch(r){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;case"NEQ":return t!==e;case"R":return m(e).test(t);default:return!1}},m=function(t){var e=t.replace(/.*\/([gimuy]*)$/,"$1");e===t&&(e="");var r=e?t.replace(new RegExp("^/(.*?)/"+e+"$"),"$1"):t;return new RegExp(r,e)},y=function(){var t=new Date;return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()},w=window.ApxorLogger,F=s((function e(){var r=this;a(this,e),u(this,"mWfX","ALL"),u(this,"EFpv",[]),u(this,"NrKD",[]),u(this,"userAttributesValidated",!0),u(this,"sessionAttributeValidated",!0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(r.mWfX=t.audience.audience_type,r.EFpv=t.audience.attributes.user,r.NrKD=t.audience.attributes.session,!Array.isArray(r.EFpv)||!Array.isArray(r.NrKD))return w.error("No attributes"),!1}catch(t){return w.error(t),!1}return!0})),u(this,"validate",(function(e,i){var n=!0;"FTU"===r.mWfX&&(n=t.getController().getSessionInfo().is_first_session);var a=r.SuAX(e,r.EFpv),o=r.SuAX(i,r.NrKD);return a||(r.userAttributesValidated=!1),o||(r.sessionAttributeValidated=!1),n&&a&&o})),u(this,"SuAX",(function(t,e){var r=e.length,i=!0;try{for(var n,a=function(){var r=e[o];if(void 0===t[r.name]||!1===i)return{v:!1};var n=r.operator,a=r.type,s=r.value.map((function(t){if("s"===a)return t;if("l"===a)return parseInt(t);if("f"===a)return parseFloat(t);if("b"===a)switch(t){case"true":return!0;case"false":return!1}})),u=(Array.isArray(t[r.name])?t[r.name]:[t[r.name]]).some((function(t){return s.some((function(e){return"s"===a?t="".concat(t):"l"===a?t=parseInt(t):"f"===a?t=parseFloat(t):"b"===a&&(t=!!t),_(t,e,n)}))}));i=i&&u},o=0;o<r;o++)if(n=a())return n.v}catch(t){w.error(t),i=!1}return i}))})),A=window.ApxorLogger,x=s((function e(){var r=this;a(this,e),u(this,"JLkp",0),u(this,"aJNm",0),u(this,"FffW","SESSION"),u(this,"ZWvp",0),u(this,"RDCX",0),u(this,"oLCr",0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{r.aLQF=t._id,r.QxUO=t.meta,r.JLkp=t.frequency.count,-1===r.JLkp&&(r.JLkp=1e3),r.oLCr=r.JLkp,r.aJNm=t.frequency.time_interval,r.FffW=t.frequency.validity,r.RDCX=t.frequency.ses_lmt,r._dayCount=t.frequency.day_lmt;var e=Y.getInstance().getQeState();if(!f(e)||!f(e[t._id]))return!0;if("SESSION"===r.FffW){if(r.JLkp=parseInt(r.JLkp)-parseInt(e[t._id].SESSION),r.JLkp<=0)return r.PJAz("Session limit reached"),console.warn("Max count limit reached for session:"+t._id),!1}else{if("OVERALL"!==r.FffW)return A.info("Invalid config."),!1;if(r.JLkp=parseInt(r.JLkp)-parseInt(e[t._id].OVERALL),r.JLkp<=0)return r.PJAz("Overall limit reached"),console.warn("Max count limit reached for overall:"+t._id),!1}}catch(t){return A.error(t),!1}return!0})),u(this,"NNxI",(function(){r.JLkp=r.JLkp-1})),u(this,"getFrequencyCount",(function(){return r.JLkp})),u(this,"ZEzV",(function(){"SESSION"===r.FffW&&(r.JLkp=r.oLCr,A.info("Campaign Limit reset"))})),u(this,"yyuX",(function(t){try{if(r.JLkp<=0)return r.PJAz("Overall limit reached"),!1;var e=Y.getInstance().getQeState();if(!f(e)||!f(e[t]))return!0;if(0!==r.RDCX)if(parseInt(r.RDCX)-parseInt(e[t].SESSION)<=0)return r.PJAz("Session limit reached"),!1;if(0!==r._dayCount){var i,n=y();if(parseInt(r._dayCount)-parseInt((null===(i=e[t])||void 0===i?void 0:i.DATES[n])||0)<=0)return r.PJAz("Day limit reached"),!1}}catch(t){r.PJAz("Error validating the frequency: ".concat(t)),A.error("Error validating the frequency:"+t)}return!0})),u(this,"PJAz",(function(e){var i;null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.QxUO.type?"survey":"campaign",apx_nudge_id:r.aLQF,apx_nudge_name:r.QxUO.name,apx_variant_code:r.QxUO.isExperiment||r.QxUO.only_context?null===(i=r.QxUO.attr)||void 0===i?void 0:i.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:e})}))})),S=s((function t(){var e=this;a(this,t),u(this,"SlUy",""),u(this,"mWfX",""),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r,i;e.SlUy=t.meta.name,e.mWfX=t.meta.type,e._only_context=t.meta.only_context,e._attr=(null===(r=t.meta)||void 0===r?void 0:r.attr)||{},e._isExperiment=null===(i=t.meta)||void 0===i?void 0:i.isExperiment}catch(t){return window.ApxorLogger.error(t),!1}return!0}))})),U=window.ApxorLogger,E=s((function t(){var e=this;a(this,t),u(this,"msBG",-1),u(this,"xYVF",-1),u(this,"ODwe",-1),u(this,"knzF",-1),u(this,"iNUU",!1),u(this,"_nudge_expired",!1),u(this,"_not_yet_active",!1),u(this,"_not_in_specified_time",!1),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(t.validity.start_date))||isNaN(Date.parse(t.validity.end_date)))return U.error("Not valid dates"),!1;if(e.msBG=Date.parse(t.validity.start_date),e.xYVF=Date.parse(t.validity.end_date),f(t.at_specific_time)&&(e.iNUU=t.at_specific_time,e.iNUU&&f(t.time_limits))){var r=(new Date).toISOString().split("T")[0];if(e.ODwe=Date.parse(r+"T"+t.time_limits.start_time+":00.000Z"),e.knzF=Date.parse(r+"T"+t.time_limits.end_time+":00.000Z"),isNaN(e.ODwe)||isNaN(e.knzF))return U.error("Not valid times"),!1}}catch(t){return U.error(t),!1}return!0})),u(this,"validate",(function(){var t=Date.now();return t>e.msBG&&t<e.xYVF?(!e.iNUU||t>=e.ODwe&&t<=e.knzF||(e._not_in_specified_time=!0),!e.iNUU||t>=e.ODwe&&t<=e.knzF):(t<e.msBG?e._not_yet_active=!0:t>e.xYVF&&(e._nudge_expired=!0),!1)}))})),b=s((function t(){var e=this;a(this,t),u(this,"SlUy",""),u(this,"wJiK",{}),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.SlUy=t.name,e.wJiK=t.additional_info}catch(t){return!1}return!0}))})),L=s((function t(){var e=this;a(this,t),u(this,"ALNq",0),u(this,"PDbG",0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.ALNq=Number(t.lower),e.PDbG=Number(t.upper),isNaN(e.ALNq)||isNaN(e.PDbG))return!1}catch(t){return!1}return!0}))})),D=s((function t(){var e=this;a(this,t),u(this,"JLml",0),u(this,"zAqk",""),u(this,"pUHH",""),u(this,"HuWU",new b),u(this,"itVi",new L),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.zAqk=t.event_type,e.pUHH=t.activity,e.HuWU.parse(t.details)&&e.itVi.parse(t.time_bounds)}catch(t){return!1}}))})),O=window.ApxorLogger,I=s((function t(){var e=this;a(this,t),u(this,"JLml",0),u(this,"Ldpj",-1),u(this,"JLkp",0),u(this,"kNFL",""),u(this,"pUHH",""),u(this,"zAqk",""),u(this,"itVi",new L),u(this,"HuWU",new b),u(this,"vois",new D),u(this,"laAz","AND"),u(this,"Rejp",!1),u(this,"mWfX",void 0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.Ldpj=t.sequence,e.JLkp=t.count_config.count,e.kNFL=t.count_config.operator,e.pUHH=t.activity,e.zAqk=t.event_type,e.laAz=t.combine_operator,e.mWfX=t.type,e.HuWU.parse(t.details)&&e.vois.parse(t.trigger)&&e.itVi.parse(t.time_bounds)}catch(t){return O.error(t),!1}}))})),N=window.ApxorLogger,k=s((function t(){var e=this;a(this,t),u(this,"JLkp",0),u(this,"kNFL",""),u(this,"zAqk",""),u(this,"itVi",new L),u(this,"HuWU",new b),u(this,"laAz","AND"),u(this,"parse",(function(t){try{return e.JLkp=t.count_config.count,e.kNFL=t.count_config.operator,e.zAqk=t.event_type,e.laAz=t.combine_operator,e.HuWU.parse(t.details)&&e.itVi.parse(t.time_bounds)}catch(t){return N.error(t),!1}}))})),W=window.ApxorLogger,Q=function(){function e(){var r=this;a(this,e),u(this,"TmSI",0),u(this,"aLQF",""),u(this,"rwtZ",new I),u(this,"LEdG",new k),u(this,"mYPi",!1),u(this,"DwEK",!1),u(this,"JFzU",0),u(this,"laAz","AND"),u(this,"kLiP","OR"),u(this,"qZWI",-1),u(this,"hYKe",[]),u(this,"WdgG",{}),u(this,"unky",!1),u(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(r.aLQF=i,r.JFzU=n,r.hYKe=o,"termination"===s&&""!==s){r.LEdG.parse(e);return r.kLiP=r.LEdG.laAz,r.myyE(),!0}var u=r.rwtZ.parse(e);if(u){if(r.laAz=r.rwtZ.laAz,r.rwtZ.Rejp){var l=r.rwtZ.HuWU.SlUy;"APX_PAGE_OPENED"===l&&(l=r.rwtZ.HuWU.wJiK.navigation_id,l=f(l)?l:r.rwtZ.HuWU.SlUy),r.qZWI=t.getController().getEventCount(l);var c=r.rwtZ.JLkp,d=r.rwtZ.kNFL;if(r.DwEK=r.uqNB(r.qZWI-1,c,d,!1),r.mYPi=r.DwEK,r.DwEK&&"APX_PAGE_OPENED"===r.rwtZ.HuWU.SlUy)return!0}return a&&0!==n||r.pjWB(),!0}return!1})),u(this,"pjWB",(function(){var t,e=r.rwtZ,i=e.vois,n=Y.getInstance();"app_start"===i.zAqk?(r.mYPi=!0,n.registerForEvent(p(e.zAqk)+"___"+e.HuWU.SlUy,r.sxhU)):n.registerForEvent(p(e.zAqk)+"___"+i.HuWU.SlUy,r.sxhU),null!==(t=window.ApxorRTM)&&void 0!==t&&t.badgesLists.includes(r.aLQF)&&n.registerForEvent(p(e.zAqk)+"___"+"apxor-badge-container-".concat("-".concat(r.aLQF).replaceAll(" ","").replace(/[^\w\s]/gi,"")),r.sxhU)})),u(this,"myyE",(function(){var t=r.LEdG,e=Y.getInstance();r.mYPi=!0,e.registerForEvent(p(t.zAqk)+"___"+t.HuWU.SlUy,r.zkSl)})),u(this,"vfgj",(function(t,e,i,n){var a,o=(Date.now()-r.WdgG[e])/1e3;(null===(a=r.rwtZ)||void 0===a||null===(a=a.HuWU)||void 0===a||null===(a=a.wJiK)||void 0===a?void 0:a.time)/1e3>o&&r._displayCampaign(i)})),u(this,"fZpM",(function(t,e,i,n){var a,o;r.unky=!0;var s=Date.now(),u=null===(a=r.rwtZ)||void 0===a||null===(a=a.vois)||void 0===a?void 0:a.HuWU.SlUy,l=(s-r.WdgG[u])/1e3,c=null===(o=r.rwtZ)||void 0===o||null===(o=o.HuWU)||void 0===o||null===(o=o.wJiK)||void 0===o?void 0:o.time;(c/=1e3)>l&&r._displayCampaign(i)})),u(this,"sxhU",(function(e,i,n,a){var o,s,u=Y.getInstance();if(r.mYPi){if(null!==(o=window.ApxorRTM)&&void 0!==o&&o.isBadgePresent&&null!==(s=window.ApxorRTM)&&void 0!==s&&s.badgesLists.includes(r.aLQF)&&t.getController().isBadgeTriggerSatisfied(r.aLQF))return r.DwEK=!0,r.rwtZ.JLml=n,void u.validate(r.aLQF,r.JFzU);p(r.rwtZ.zAqk)===e&&r.XpiA(n-r.rwtZ.vois.JLml,r.rwtZ.itVi)&&r.rwtZ.HuWU.SlUy===i&&r.QvGV(r.rwtZ.HuWU.wJiK,a)&&(r.TmSI+=1,r.DwEK=r.uqNB(r.TmSI,r.rwtZ.JLkp,r.rwtZ.kNFL),r.DwEK&&(r.rwtZ.JLml=n,u.validate(r.aLQF,r.JFzU)))}else if(r.mYPi=r.mkCW(e,i,n,a),r.mYPi){var l=r.rwtZ,c=l.vois;if(c.JLml=n,"activity_time"===(null==l?void 0:l.zAqk)){var f,d,v,h=null==l||null===(f=l.HuWU)||void 0===f||null===(f=f.wJiK)||void 0===f?void 0:f.time;(null==l||null===(d=l.HuWU)||void 0===d||null===(d=d.wJiK)||void 0===d?void 0:d.nkpi.length)>0&&(setTimeout((function(){r.unky||(r.DwEK=!0,r.DwEK&&(r.TmSI+=1,r.DwEK=r.uqNB(r.TmSI,r.rwtZ.JLkp,r.rwtZ.kNFL),r.DwEK&&(r.rwtZ.JLml=n,u.validate(r.aLQF,r.JFzU)))),l.HuWU.wJiK.nkpi.map((function(t){u.unregisterFromEvent(g(l.HuWU.wJiK.et)+"___"+t,r)}))}),h),l.HuWU.wJiK.nkpi.map((function(t){u.registerForEvent(g(l.HuWU.wJiK.et)+"___"+t,r.fZpM)}))),(null==l||null===(v=l.HuWU)||void 0===v||null===(v=v.wJiK)||void 0===v?void 0:v.kpi.length)>0&&(setTimeout((function(){l.HuWU.wJiK.kpi.map((function(t){u.unregisterFromEvent(g(l.HuWU.wJiK.et)+"___"+t,r)}))}),h),l.HuWU.wJiK.kpi.map((function(t){t===l.vois.HuWU.SlUy?(u.unregisterFromEvent(p(c.zAqk)+"___"+c.HuWU.SlUy,r),u.registerForEvent(g(l.HuWU.wJiK.et)+"___"+t,r.vfgj)):u.registerForEvent(g(l.HuWU.wJiK.et)+"___"+t,r.fZpM)})))}else u.unregisterFromEvent(p(c.zAqk)+"___"+c.HuWU.SlUy,r),u.registerForEvent(p(l.zAqk)+"___"+l.HuWU.SlUy,r);r.WdgG[i]=Date.now()}})),u(this,"zkSl",(function(t,e,i,n){var a=Y.getInstance();p(r.LEdG.zAqk)===t&&r.XpiA(i,r.LEdG.itVi)&&r.LEdG.HuWU.SlUy===e&&r.QvGV(r.LEdG.HuWU.wJiK,n)&&(r.TmSI+=1,r.DwEK=r.uqNB(r.TmSI,r.LEdG.JLkp,r.LEdG.kNFL),r.DwEK&&(r.LEdG.JLml=i,a.validateForTermination(r.aLQF,r.JFzU)))})),u(this,"mkCW",(function(t,e,i,n){var a=r.rwtZ.vois;return p(a.zAqk)===t&&a.HuWU.SlUy===e&&r.XpiA(i,a.itVi)&&r.QvGV(a.HuWU.wJiK,n)})),u(this,"XpiA",(function(t,e){var r=Math.ceil(t);return r>e.ALNq&&r<e.PDbG})),u(this,"uqNB",(function(t,e,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(n&&r.rwtZ.Rejp&&(t+=r.qZWI),i){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;default:return!1}})),u(this,"QvGV",(function(t,e){var r=!0;try{var i,a=function(){if(!e[o]||!1===r)return{v:!1};if("object"===n(t[o])){var i,a=t[o].op,s=t[o].t;"s"===s?i=t[o].val:"l"!==s&&"f"!==s||(i=parseFloat(t[o].val));var u=(Array.isArray(e[o])?e[o]:[e[o]]).some((function(t){return _(t,i,a)}));r=r&&u}else r=r&&_(e[o],t[o],"EQ")};for(var o in t)if(i=a())return i.v}catch(t){W.error(t),r=!1}return r}))}return s(e,[{key:"_displayCampaign",value:function(t){var e=Y.getInstance();this.DwEK=!0,this.DwEK&&(this.TmSI+=1,this.DwEK=this.uqNB(this.TmSI,this.rwtZ.JLkp,this.rwtZ.kNFL),this.DwEK&&(this.rwtZ.JLml=t,e.validate(this.aLQF,this.JFzU)))}}]),e}(),C=window.ApxorLogger,J=s((function e(){var r=this;a(this,e),u(this,"bcDN",[]),u(this,"_ret_day",{}),u(this,"pfgJ",{}),u(this,"XMSc",!1),u(this,"ytpX",!1),u(this,"retainedDaysValidated",!0),u(this,"retainedSessionValidated",!0),u(this,"eventDoneInLT",!1),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{r.bcDN=t.overall_cfg.events,r._ret_day=t.overall_cfg.ret_day,r.pfgJ=t.overall_cfg.session,r.XMSc=t.overall_cfg.toggleRetDay,r.ytpX=t.overall_cfg.toggleSession}catch(t){return C.error(t),!1}return!0})),u(this,"validate",(function(){var e=parseInt(t.getController().getFromStorage("apx_retained_days")),i=parseInt(t.getController().getFromStorage("apx_retained_session"));if(r.XMSc&&!isNaN(e)&&!(e>=r._ret_day.from&&e<=r._ret_day.to))return r.retainedDaysValidated=!1,!1;if(r.ytpX&&!isNaN(i)&&!(i>=r.pfgJ.from&&i<=r.pfgJ.to))return r.retainedSessionValidated=!1,!1;try{for(var n=t.getController().getFromStorage("_apx_lt_count"),a=t.getSiteId(),o=JSON.parse((new TextDecoder).decode(function(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return e}(h(a,n)))),s=0;s<r.bcDN.length;s++){if(o[r.bcDN[s].name.replace("'","").replace("â€™","")])return r.eventDoneInLT=!0,!1}}catch(t){C.error("Failed to validate the lt count:"+t)}return!0}))})),T=window.ApxorLogger,K=s((function t(){var e=this;a(this,t),u(this,"EFpv",[]),u(this,"NrKD",[]),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.EFpv=t.attributes.user,e.NrKD=t.attributes.session,!Array.isArray(e.EFpv)||!Array.isArray(e.NrKD))return T.error("No attributes"),!1}catch(t){return T.error(t),!1}return!0})),u(this,"validate",(function(t,r){return e.SuAX(t,e.EFpv)&&e.SuAX(r,e.NrKD)})),u(this,"SuAX",(function(t,e){var r=e.length,i=!0;try{for(var n,a=function(){var r=e[o];if(!t[r.name]||!1===i)return{v:!1};var n=r.operator,a=r.type,s=r.value.map((function(t){return"s"===a?t:"l"===a?parseInt(t):"f"===a?parseFloat(t):void 0})),u=(Array.isArray(t[r.name])?t[r.name]:[t[r.name]]).some((function(t){return s.some((function(e){return _(t,e,n)}))}));i=i&&u},o=0;o<r;o++)if(n=a())return n.v}catch(t){T.error(t),i=!1}return i}))})),z=s((function e(){var r=this;a(this,e),u(this,"vTBN",t.getController()),u(this,"type",""),u(this,"_duration_seconds",0),u(this,"GwFb",1),u(this,"parse",(function(t){try{var e,i,n;if(r.mWfX=null===(e=t.terminate_info.time_based)||void 0===e?void 0:e.type,r._duration_seconds=null===(i=t.terminate_info)||void 0===i?void 0:i.time_based.duration_seconds,r.GwFb=null===(n=t.terminate_info.time_based)||void 0===n?void 0:n.days,r.wWbg(t._id))return r.vTBN.persistTerminationInfoLocally(t._id),!1}catch(t){return!1}return!0})),u(this,"wWbg",(function(t){var e,i=JSON.parse(r.vTBN.getFromStorage("apx_termination_ID"));if(!i[t]||null===(e=i[t])||void 0===e||!e.startDate)return!1;var n,a=new Date(i[t].startDate),o=new Date((n=new Date).getMonth()+"/"+n.getDate()+"/"+n.getFullYear()),s=parseInt((o-a)/864e5,10),u=function(){var t=new Date;return{hours:t.getHours(),mins:t.getMinutes()}}(),l=i[t].ODwe;return s===r.GwFb&&u.hours>=l.hours||s>r.GwFb||i[t].goalAcheived}))})),P=s((function t(){var e=this;a(this,t),u(this,"enable_goal_events",!1),u(this,"attributes",{}),u(this,"Amqr",new K),u(this,"kJfa",new z),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r,i,n;if(e.enable_time_based=null==t||null===(r=t.terminate_info)||void 0===r?void 0:r.enable_time_based,e.enable_time_based&&!e.kJfa.parse(t))return!1;if(e.enable_goal_events=null==t||null===(i=t.terminate_info)||void 0===i?void 0:i.enable_goal_events,e.enable_attributes=null==t||null===(n=t.terminate_info)||void 0===n?void 0:n.enable_attributes,e.enable_attributes&&!e.Amqr.parse(t.terminate_info))return!1}catch(t){return window.ApxorLogger.error(t),!1}return!0})),u(this,"validate",(function(t,r){return e.Amqr.validate(t,r)}))})),q=window.ApxorLogger,H=s((function e(){var i=this;a(this,e),u(this,"PeFH",[]),u(this,"ZKda",[]),u(this,"aLQF",""),u(this,"QxUO",new S),u(this,"IFiU",new F),u(this,"FffW",new E),u(this,"zmxK",new x),u(this,"lYIS",new J),u(this,"EFEy",new P),u(this,"GpiA",!1),u(this,"voOF",[]),u(this,"_variant_code",""),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e;if(!f(t._id))return q.error("No Id"),!1;if(!f(t.enabled)||!t.enabled)return q.error("Not enabled"),!1;if(!(i.QxUO.parse(t)&&i.FffW.parse(t)&&i.zmxK.parse(t)&&i.IFiU.parse(t)&&i.lYIS.parse(t)&&i.EFEy.parse(t)))return!1;if(i._variant_code=i.QxUO._isExperiment||i.QxUO._only_context?null===(e=i.QxUO._attr)||void 0===e?void 0:e.apx_variant_code:"TG",!f(t.conditions)||!Array.isArray(t.conditions))return q.error("No valid conditions",t.conditions),!1;i.aLQF=t._id,i.GpiA=!!f(t.sequence_enabled)&&t.sequence_enabled,i.GpiA&&t.conditions.sort((function(t,e){return t.sequence<e.sequence}));for(var r=t.conditions,n=r.length,a=0;a<n;a++){i.voOF=[];var o=r[a];if("didn't"===o.type){var s,u={trigger_key:o.trigger.details.name,no_kpi_array:null==o||null===(s=o.details)||void 0===s||null===(s=s.additional_info)||void 0===s?void 0:s.nkpi,condition_id:null==o?void 0:o._id,time_bounds:o.time_bounds.upper};i.voOF=[].concat(l(i.voOF),[u])}var c=new Q;c.initialize(o,i.aLQF,a,i.GpiA,i.voOF)&&i.PeFH.push(c)}if(i.EFEy.enable_goal_events)for(var d=t.terminate_info.goal_events.events,v=d.length,h=0;h<v;h++){var p=new Q;p.initialize(d[h],i.aLQF,h,!0,[],"termination")&&i.ZKda.push(p)}return i.PeFH.length>0}catch(t){return q.error(t),!1}})),u(this,"tQiW",(function(t){if(!(t<0))if(i.GpiA){var e=i.PeFH[t];if(f(e)&&e.DwEK){var r=i.PeFH[t-1];if(f(r)&&!r.DwEK)return;var n=i.PeFH[t+1];f(n)?n.pjWB():i.VmlT()}}else i.VmlT()})),u(this,"lcIx",(function(t){t<0||i.Wtlx()})),u(this,"VmlT",(function(){var e,n,a=t.getController().getUserAttributes(),o=t.getController().getSessionAttributes();if(null!==(e=window.ApxorRTM)&&void 0!==e&&e.isBadgePresent&&null!==(n=window.ApxorRTM)&&void 0!==n&&n.badgesLists.includes(i.aLQF)&&t.getController().isBadgeTriggerSatisfied(i.aLQF)||null==t||t.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===i.QxUO.mWfX?"survey":"campaign",apx_nudge_id:i.aLQF,apx_nudge_name:i.QxUO.SlUy,apx_variant_code:i.QxUO._isExperiment||i.QxUO._only_context?i.QxUO._attr.apx_variant_code:"TG"}),!i.FffW.validate()||!i.IFiU.validate(a,o)||!i.lYIS.validate())return i.lYIS.retainedDaysValidated||i.PJAz("Retained day criteria not met"),i.lYIS.retainedSessionValidated||i.PJAz("User session criteria not met"),i.lYIS.eventDoneInLT&&i.PJAz("Event done in life time"),i.IFiU.userAttributesValidated||i.PJAz("User property filter not met"),i.IFiU.sessionAttributeValidated||i.PJAz("Session property filter not met"),i.FffW._not_in_specified_time&&i.PJAz("Time limits check failed"),i.FffW._not_yet_active&&i.PJAz("not in the scheduled time"),void(i.FffW._nudge_expired&&i.PJAz("nudge expired"));for(var s=i.PeFH.length,u=s<1,l="",c=0;c<s;c++){var f=i.PeFH[c],d=f.DwEK;if(""===l.trim())u=d;else switch(l){case"AND":u=u&&d;break;case"OR":u=u||d}l=f.laAz}if(u){if(console.debug("onCondition satisfied"),!i.zmxK.yyuX(i.aLQF))return void console.warn("Maximum limit reached",i.aLQF);console.log("Dispatching event",i.QxUO.mWfX),t.logEvent("apx_context_evaluated",r(r({apx_nudge_type:"SURVEY"===i.QxUO.mWfX?"survey":"campaign",apx_nudge_id:i.aLQF,apx_nudge_name:i.QxUO.SlUy,apx_variant_code:i.QxUO._isExperiment||i.QxUO._only_context?i.QxUO._attr.apx_variant_code:"TG"},i.QxUO._attr),{},{message_name:i.QxUO.SlUy,id:i.aLQF})),t.getController().dispatchEvent(i.QxUO.mWfX,{name:i.QxUO.mWfX,additional_info:{uuid:i.aLQF,name:i.QxUO.SlUy}})}})),u(this,"Wtlx",(function(){for(var e=i.ZKda.length,n=e<1,a="",o=0;o<e;o++){var s=i.ZKda[o],u=s.DwEK;if(""===a.trim())n=u;else switch(a){case"AND":n=n&&u;break;case"OR":n=n||u}a=s.kLiP}n&&(console.log("Dispatching event",i.QxUO.mWfX),t.getController().persistTerminationInfoLocally(i.aLQF),!0===i.QxUO._only_context&&t.logEvent("apx_context_evaluated",r(r({},i.QxUO._attr),{},{message_name:i.QxUO.SlUy,id:i.aLQF})),t.getController().dispatchEvent(i.QxUO.mWfX,{name:i.QxUO.mWfX,additional_info:{uuid:i.aLQF,name:i.QxUO.SlUy}}))})),u(this,"validateForTerminationAttributes",(function(){var e=t.getController().getUserAttributes(),r=t.getController().getSessionAttributes();return i.EFEy.validate(e,r)})),u(this,"NNxI",(function(){i.zmxK.NNxI()})),u(this,"getFrequencyCount",(function(){return i.zmxK.getFrequencyCount()})),u(this,"FKbe",(function(){return i.zmxK.ZEzV()})),u(this,"PJAz",(function(e){var r;null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===i.QxUO.type?"survey":"campaign",apx_nudge_id:i.aLQF,apx_nudge_name:i.QxUO.name,apx_variant_code:i.QxUO.isExperiment||i.QxUO.only_context?null===(r=i.QxUO.attr)||void 0===r?void 0:r.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:e})}))})),Z=s((function t(){var e=this;a(this,t),u(this,"WPFv",{}),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(f(t)&&f(t.configs)){var r=t.configs;if(!Array.isArray(r))return;r.sort((function(t,e){var r,i;return(null!==(r=t.prio)&&void 0!==r?r:-1)-(null!==(i=e.prio)&&void 0!==i?i:-1)}));for(var i=0;i<r.length;i++){var n=r[i],a=n._id,o=new H;o.parse(n)?e.WPFv[a]=o:console.warn("Failed to parse cfg",a)}}})),u(this,"validate",(function(t,r){e.WPFv[t]&&e.WPFv[t].tQiW(r)})),u(this,"getVariantCode",(function(t){return e.WPFv[t]?e.WPFv[t]._variant_code:""})),u(this,"validateForTermination",(function(t,r){e.WPFv[t]&&e.WPFv[t].lcIx(r)})),u(this,"validateForTerminationAttributes",(function(t){return!!e.WPFv[t]&&e.WPFv[t].validateForTerminationAttributes()})),u(this,"NNxI",(function(t){e.WPFv[t].NNxI()})),u(this,"getFrequencyCount",(function(t){return e.WPFv[t].getFrequencyCount()})),u(this,"resetFrequencyCounts",(function(){var t=e.WPFv;for(var r in t)t[r].FKbe()})),u(this,"vHHH",(function(t){try{if(e.WPFv){var r=e.WPFv[t];if(r&&r.QxUO)return r.QxUO}}catch(t){console.log("Error in getting the campaign meta ".concat(t))}return{}}))})),V=window.ApxorLogger,j=s((function e(){var r=this;a(this,e),u(this,"aCKU",{}),u(this,"LDxa",[]),u(this,"tHTo",!1),u(this,"initialize",(function(){var e=t.getController();e.registerForEvent("APP_EVENT",(function(t){return r.bMqR(t,"AE")})),e.registerForEvent("CLIENT_EVENT",(function(t){return r.bMqR(t,"CE")}))})),u(this,"uckn",(function(){for(var t in r.LDxa)r.oIKZ(t.event,t.key,t.type);r.tHTo=!0})),u(this,"bOAb",(function(t,e){var i;"function"==typeof e&&((i=r.aCKU[t]?r.aCKU[t]:[]).push(e),r.aCKU[t]=i,V.debug("Listeners list: ",r.aCKU))})),u(this,"unregisterFromEvent",(function(t,e){if(r.aCKU[t]){for(var i=r.aCKU[t],n=[],a=0;a<i.length;a++){var o=i[a];o!==e&&n.push(o)}r.aCKU[t]=n}})),u(this,"bMqR",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE",i=e+"___"+t.name;r.oIKZ(t,i,e)})),u(this,"oIKZ",(function(e,i,n){if(r.tHTo){if(V.debug("Notifying listeners for event: "+e+", "+i,r.aCKU),r.aCKU[i])for(var a=r.aCKU[i],o=t.getController().getSDKRunningTimeInSec(),s=0;s<a.length;s++){(0,a[s])(n,e.name,o,e.additional_info)}}else r.LDxa.push({event:e,key:i,type:n})}))})),G=window.ApxorLogger,Y=function(){function e(){var r=this;return a(this,e),u(this,"euLH",!1),u(this,"OjFD",null),u(this,"DIrk",y()),u(this,"MCTz",new j),u(this,"EJrI",t.getSiteId()),u(this,"DYIS",{}),u(this,"getQeState",(function(){try{var e=t.getController().getFromStorage("qe_state");return e?JSON.parse(h(r.EJrI,e)):(r.DYIS={},r.setQeState())}catch(t){return r.DYIS={},r.setQeState()}})),u(this,"setQeState",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{t.getController().persistToStorage("qe_state",r.DYIS,!0)}catch(i){""===e?r.DYIS={}:r.DYIS[e]={SESSION:0,OVERALL:0,DATES:{}},t.getController().persistToStorage("qe_state",r.DYIS,!0)}return r.DYIS})),u(this,"initialize",(function(){r.euLH||(r.euLH=!0,r.OjFD=new Z,r.MCTz.initialize(),r.DYIS=r.getQeState(),G.info("QE Initialized.."))})),u(this,"parse",(function(t){r.CAYK()?(r.OjFD.parse(t),r.MCTz.uckn()):G.warn("Must call init first. Unable to proceed")})),u(this,"validate",(function(t,e){r.CAYK()&&r.OjFD.validate(t,e)})),u(this,"getVariantCode",(function(t){return r.OjFD.getVariantCode(t)})),u(this,"validateForTermination",(function(t,e){r.CAYK()&&r.OjFD.validateForTermination(t,e)})),u(this,"validateForTerminationAttributes",(function(t,e){return r.OjFD.validateForTerminationAttributes(t,e)})),u(this,"updateCount",(function(t){try{f(r.DYIS[t])||r.createObjConfig(t),r.incrementFrequencies(t),r.setQeState(t),r.OjFD.NNxI(t)}catch(t){console.log("Could not update the count config:".concat(t))}})),u(this,"resetFrequencyCounts",(function(){r.OjFD.resetFrequencyCounts()})),u(this,"getFrequencyCount",(function(t){return r.OjFD.getFrequencyCount(t)})),u(this,"registerForEvent",(function(t,e){r.MCTz.bOAb(t,e)})),u(this,"unregisterFromEvent",(function(t,e){r.MCTz.unregisterFromEvent(t,e)})),u(this,"notifyEventListener",(function(t){r.MCTz.bMqR(t)})),u(this,"fetch",(function(e,r,i,n){t.getController().fetchConfiguration(e,r,i,n)})),u(this,"CAYK",(function(){return r.euLH})),u(this,"getCampaignMetaFromQueryEngine",(function(t){return r.OjFD.vHHH(t)})),u(this,"KiEH",(function(){return r.DIrk})),e.instance||(e.instance=this),e.instance}return s(e,[{key:"createObjConfig",value:function(t){try{this.DYIS=this.getQeState(),f(this.DYIS[t])||(this.DYIS[t]={SESSION:0,OVERALL:0,DATES:{}},this.DIrk&&(this.DYIS[t].DATES[this.DIrk]=0),this.setQeState(t))}catch(t){G.error("Can not create the frequency count object:"+t)}}},{key:"incrementFrequencies",value:function(t){this.DYIS=this.getQeState();var e=this.DYIS[t];e.SESSION=e.SESSION+1,e.OVERALL=e.OVERALL+1;var r=y();r===this.DIrk&&e.DATES&&e.DATES[r]||(this.DIrk=r,e.DATES={},e.DATES[this.DIrk]=0),e.DATES[this.DIrk]=e.DATES[this.DIrk]+1}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();u(Y,"instance",void 0),window.ceVersion=151;try{void 0===exports&&null===exports||(exports.default=Y,module.exports=exports.default)}catch(t){}return Y}));
