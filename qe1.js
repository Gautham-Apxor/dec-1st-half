!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],e):(t=t||self)["apxor-qe"]=e(t.Apxor)}(this,(function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){u(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function n(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,n(i.key),i)}}function s(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e,r){return(e=n(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var c=function(t){return void 0!==t&&!function(t){return null===t}(t)},d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function _(t,e){return Array.from(e).map((function(e,r){return String.fromCharCode(e^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,r))})).join("")}var h=function(t,e){return _(t,e=function(t){var e,r,n,i,a,o,s=0,u=[];if(!t)return t;t+="";do{e=(o=d.indexOf(t.charAt(s++))<<18|d.indexOf(t.charAt(s++))<<12|(i=d.indexOf(t.charAt(s++)))<<6|(a=d.indexOf(t.charAt(s++))))>>16&255,r=o>>8&255,n=255&o,u.push(e),64!==i&&(u.push(r),64!==a&&u.push(n))}while(s<t.length);return u}(e))},v=function(t){switch(t){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE"}return"Unknown"},p=function(t){return t.toUpperCase()},g=function(t,e,r){switch(r){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;case"NEQ":return t!==e;case"R":return m(e).test(t);default:return!1}},m=function(t){var e=t.replace(/.*\/([gimuy]*)$/,"$1");e===t&&(e="");var r=e?t.replace(new RegExp("^/(.*?)/"+e+"$"),"$1"):t;return new RegExp(r,e)},y=function(){var t=new Date;return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()},x=window.ApxorLogger,E=s((function e(){var r=this;a(this,e),u(this,"vZJD","ALL"),u(this,"lybV",[]),u(this,"YFoC",[]),u(this,"userAttributesValidated",!0),u(this,"sessionAttributeValidated",!0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(r.vZJD=t.audience.audience_type,r.lybV=t.audience.attributes.user,r.YFoC=t.audience.attributes.session,!Array.isArray(r.lybV)||!Array.isArray(r.YFoC))return x.error("No attributes"),!1}catch(t){return x.error(t),!1}return!0})),u(this,"validate",(function(e,n){var i=!0;"FTU"===r.vZJD&&(i=t.getController().getSessionInfo().is_first_session);var a=r.USQe(e,r.lybV),o=r.USQe(n,r.YFoC);return a||(r.userAttributesValidated=!1),o||(r.sessionAttributeValidated=!1),i&&a&&o})),u(this,"USQe",(function(t,e){var r=e.length,n=!0;try{for(var i,a=function(){var r=e[o];if(void 0===t[r.name]||!1===n)return{v:!1};var i=r.operator,a=r.type,s=r.value.map((function(t){if("s"===a)return t;if("l"===a)return parseInt(t);if("f"===a)return parseFloat(t);if("b"===a)switch(t){case"true":return!0;case"false":return!1}})),u=(Array.isArray(t[r.name])?t[r.name]:[t[r.name]]).some((function(t){return s.some((function(e){return"s"===a?t="".concat(t):"l"===a?t=parseInt(t):"f"===a?t=parseFloat(t):"b"===a&&(t=!!t),g(t,e,i)}))}));n=n&&u},o=0;o<r;o++)if(i=a())return i.v}catch(t){x.error(t),n=!1}return n}))})),J=window.ApxorLogger,b=s((function t(){var e=this;a(this,t),u(this,"RaJi",0),u(this,"Kdjf",0),u(this,"ctYe","SESSION"),u(this,"dDiv",0),u(this,"KurF",0),u(this,"Booz",0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.RaJi=t.frequency.count,-1===e.RaJi&&(e.RaJi=1e3),e.Booz=e.RaJi,e.Kdjf=t.frequency.time_interval,e.ctYe=t.frequency.validity,e.KurF=t.frequency.ses_lmt,e._dayCount=t.frequency.day_lmt;var r=H.getInstance().getQeState();if(!c(r)||!c(r[t._id]))return!0;if("SESSION"===e.ctYe){if(e.RaJi=parseInt(e.RaJi)-parseInt(r[t._id].SESSION),e.RaJi<=0)return console.warn("Max count limit reached for session:"+t._id),!1}else{if("OVERALL"!==e.ctYe)return J.info("Invalid config."),!1;if(e.RaJi=parseInt(e.RaJi)-parseInt(r[t._id].OVERALL),e.RaJi<=0)return console.warn("Max count limit reached for overall:"+t._id),!1}}catch(t){return J.error(t),!1}return!0})),u(this,"SPyM",(function(){e.RaJi=e.RaJi-1})),u(this,"getFrequencyCount",(function(){return e.RaJi})),u(this,"gpbQ",(function(){"SESSION"===e.ctYe&&(e.RaJi=e.Booz,J.info("Campaign Limit reset"))})),u(this,"ZREd",(function(t){try{if(e.RaJi<=0)return!1;var r=H.getInstance().getQeState();if(!c(r)||!c(r[t]))return!0;if(0!==e.KurF)if(parseInt(e.KurF)-parseInt(r[t].SESSION)<=0)return!1;if(0!==e._dayCount){var n,i=y();if(parseInt(e._dayCount)-parseInt((null===(n=r[t])||void 0===n?void 0:n.DATES[i])||0)<=0)return!1}}catch(t){J.error("Error validating the frequency:"+t)}return!0}))})),V=s((function t(){var e=this;a(this,t),u(this,"WfoJ",""),u(this,"vZJD",""),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r,n;e.WfoJ=t.meta.name,e.vZJD=t.meta.type,e._only_context=t.meta.only_context,e._attr=(null===(r=t.meta)||void 0===r?void 0:r.attr)||{},e._isExperiment=null===(n=t.meta)||void 0===n?void 0:n.isExperiment}catch(t){return window.ApxorLogger.error(t),!1}return!0}))})),A=window.ApxorLogger,w=s((function t(){var e=this;a(this,t),u(this,"YwyE",-1),u(this,"UNyp",-1),u(this,"gvOT",-1),u(this,"JEbW",-1),u(this,"axfj",!1),u(this,"_nudge_expired",!1),u(this,"_not_yet_active",!1),u(this,"_not_in_specified_time",!1),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(t.validity.start_date))||isNaN(Date.parse(t.validity.end_date)))return A.error("Not valid dates"),!1;if(e.YwyE=Date.parse(t.validity.start_date),e.UNyp=Date.parse(t.validity.end_date),c(t.time_limits_in_day)&&(e.axfj=t.time_limits_in_day,e.axfj&&c(t.time_limits))){var r=(new Date).toISOString().split("T")[0];if(e.gvOT=Date.parse(r+"T"+t.time_limits.start_time+".000Z"),e.JEbW=Date.parse(r+"T"+t.time_limits.end_time+".000Z"),isNaN(e.gvOT)||isNaN(e.JEbW))return A.error("Not valid times"),!1}}catch(t){return A.error(t),!1}return!0})),u(this,"validate",(function(){var t=Date.now();return t>e.YwyE&&t<e.UNyp?(!e.axfj||t>=e.gvOT&&t<=e.JEbW||(e._not_in_specified_time=!0),!e.axfj||t>=e.gvOT&&t<=e.JEbW):(t<e.YwyE?e._not_yet_active=!0:t>e.UNyp&&(e._nudge_expired=!0),!1)}))})),D=s((function t(){var e=this;a(this,t),u(this,"WfoJ",""),u(this,"AgrI",{}),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.WfoJ=t.name,e.AgrI=t.additional_info}catch(t){return!1}return!0}))})),q=s((function t(){var e=this;a(this,t),u(this,"CJQD",0),u(this,"XFiM",0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.CJQD=Number(t.lower),e.XFiM=Number(t.upper),isNaN(e.CJQD)||isNaN(e.XFiM))return!1}catch(t){return!1}return!0}))})),T=s((function t(){var e=this;a(this,t),u(this,"eVZp",0),u(this,"bHkN",""),u(this,"msEx",""),u(this,"tDhr",new D),u(this,"Tdeq",new q),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.bHkN=t.event_type,e.msEx=t.activity,e.tDhr.parse(t.details)&&e.Tdeq.parse(t.time_bounds)}catch(t){return!1}}))})),S=window.ApxorLogger,C=s((function t(){var e=this;a(this,t),u(this,"eVZp",0),u(this,"SfLH",-1),u(this,"RaJi",0),u(this,"johA",""),u(this,"msEx",""),u(this,"bHkN",""),u(this,"Tdeq",new q),u(this,"tDhr",new D),u(this,"QAFb",new T),u(this,"Wodi","AND"),u(this,"UsFI",!1),u(this,"vZJD",void 0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.SfLH=t.sequence,e.RaJi=t.count_config.count,e.johA=t.count_config.operator,e.msEx=t.activity,e.bHkN=t.event_type,e.Wodi=t.combine_operator,e.vZJD=t.type,e.tDhr.parse(t.details)&&e.QAFb.parse(t.trigger)&&e.Tdeq.parse(t.time_bounds)}catch(t){return S.error(t),!1}}))})),N=window.ApxorLogger,W=s((function t(){var e=this;a(this,t),u(this,"RaJi",0),u(this,"johA",""),u(this,"bHkN",""),u(this,"Tdeq",new q),u(this,"tDhr",new D),u(this,"Wodi","AND"),u(this,"parse",(function(t){try{return e.RaJi=t.count_config.count,e.johA=t.count_config.operator,e.bHkN=t.event_type,e.Wodi=t.combine_operator,e.tDhr.parse(t.details)&&e.Tdeq.parse(t.time_bounds)}catch(t){return N.error(t),!1}}))})),F=window.ApxorLogger,Y=function(){function e(){var r=this;a(this,e),u(this,"TlEF",0),u(this,"lWMY",""),u(this,"JNJC",new C),u(this,"EEsW",new W),u(this,"GJRm",!1),u(this,"Ggeo",!1),u(this,"mDQO",0),u(this,"Wodi","AND"),u(this,"CchN","OR"),u(this,"SYdV",-1),u(this,"GWpR",[]),u(this,"VLCE",{}),u(this,"ezeO",!1),u(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(r.lWMY=n,r.mDQO=i,r.GWpR=o,"termination"===s&&""!==s){r.EEsW.parse(e);return r.CchN=r.EEsW.Wodi,r.GWVZ(),!0}var u=r.JNJC.parse(e);if(u){if(r.Wodi=r.JNJC.Wodi,r.JNJC.UsFI){var l=r.JNJC.tDhr.WfoJ;"APX_PAGE_OPENED"===l&&(l=r.JNJC.tDhr.AgrI.navigation_id,l=c(l)?l:r.JNJC.tDhr.WfoJ),r.SYdV=t.getController().getEventCount(l);var f=r.JNJC.RaJi,d=r.JNJC.johA;if(r.Ggeo=r.VhNV(r.SYdV-1,f,d,!1),r.GJRm=r.Ggeo,r.Ggeo&&"APX_PAGE_OPENED"===r.JNJC.tDhr.WfoJ)return!0}return a&&0!==i||r.xHpZ(),!0}return!1})),u(this,"xHpZ",(function(){var t,e=r.JNJC,n=e.QAFb,i=H.getInstance();"app_start"===n.bHkN?(r.GJRm=!0,i.registerForEvent(v(e.bHkN)+"___"+e.tDhr.WfoJ,r.ZcOp)):i.registerForEvent(v(e.bHkN)+"___"+n.tDhr.WfoJ,r.ZcOp),null!==(t=window.ApxorRTM)&&void 0!==t&&t.badgesLists.includes(r.lWMY)&&i.registerForEvent(v(e.bHkN)+"___"+"apxor-badge-container-".concat("-".concat(r.lWMY).replaceAll(" ","").replace(/[^\w\s]/gi,"")),r.ZcOp)})),u(this,"GWVZ",(function(){var t=r.EEsW,e=H.getInstance();r.GJRm=!0,e.registerForEvent(v(t.bHkN)+"___"+t.tDhr.WfoJ,r.RZgj)})),u(this,"SEPa",(function(t,e,n,i){var a,o=(Date.now()-r.VLCE[e])/1e3;(null===(a=r.JNJC)||void 0===a||null===(a=a.tDhr)||void 0===a||null===(a=a.AgrI)||void 0===a?void 0:a.time)/1e3>o&&r._displayCampaign(n)})),u(this,"bOFa",(function(t,e,n,i){var a,o;r.ezeO=!0;var s=Date.now(),u=null===(a=r.JNJC)||void 0===a||null===(a=a.QAFb)||void 0===a?void 0:a.tDhr.WfoJ,l=(s-r.VLCE[u])/1e3,f=null===(o=r.JNJC)||void 0===o||null===(o=o.tDhr)||void 0===o||null===(o=o.AgrI)||void 0===o?void 0:o.time;(f/=1e3)>l&&r._displayCampaign(n)})),u(this,"ZcOp",(function(e,n,i,a){var o,s,u=H.getInstance();if(r.GJRm){if(null!==(o=window.ApxorRTM)&&void 0!==o&&o.isBadgePresent&&null!==(s=window.ApxorRTM)&&void 0!==s&&s.badgesLists.includes(r.lWMY)&&t.getController().isBadgeTriggerSatisfied(r.lWMY))return r.Ggeo=!0,r.JNJC.eVZp=i,void u.validate(r.lWMY,r.mDQO);v(r.JNJC.bHkN)===e&&r.lxsL(i-r.JNJC.QAFb.eVZp,r.JNJC.Tdeq)&&r.JNJC.tDhr.WfoJ===n&&r.yQHW(r.JNJC.tDhr.AgrI,a)&&(r.TlEF+=1,r.Ggeo=r.VhNV(r.TlEF,r.JNJC.RaJi,r.JNJC.johA),r.Ggeo&&(r.JNJC.eVZp=i,u.validate(r.lWMY,r.mDQO)))}else if(r.GJRm=r.AiId(e,n,i,a),r.GJRm){var l=r.JNJC,f=l.QAFb;if(f.eVZp=i,"activity_time"===(null==l?void 0:l.bHkN)){var c,d,_,h=null==l||null===(c=l.tDhr)||void 0===c||null===(c=c.AgrI)||void 0===c?void 0:c.time;(null==l||null===(d=l.tDhr)||void 0===d||null===(d=d.AgrI)||void 0===d?void 0:d.nkpi.length)>0&&(setTimeout((function(){r.ezeO||(r.Ggeo=!0,r.Ggeo&&(r.TlEF+=1,r.Ggeo=r.VhNV(r.TlEF,r.JNJC.RaJi,r.JNJC.johA),r.Ggeo&&(r.JNJC.eVZp=i,u.validate(r.lWMY,r.mDQO)))),l.tDhr.AgrI.nkpi.map((function(t){u.unregisterFromEvent(p(l.tDhr.AgrI.et)+"___"+t,r)}))}),h),l.tDhr.AgrI.nkpi.map((function(t){u.registerForEvent(p(l.tDhr.AgrI.et)+"___"+t,r.bOFa)}))),(null==l||null===(_=l.tDhr)||void 0===_||null===(_=_.AgrI)||void 0===_?void 0:_.kpi.length)>0&&(setTimeout((function(){l.tDhr.AgrI.kpi.map((function(t){u.unregisterFromEvent(p(l.tDhr.AgrI.et)+"___"+t,r)}))}),h),l.tDhr.AgrI.kpi.map((function(t){t===l.QAFb.tDhr.WfoJ?(u.unregisterFromEvent(v(f.bHkN)+"___"+f.tDhr.WfoJ,r),u.registerForEvent(p(l.tDhr.AgrI.et)+"___"+t,r.SEPa)):u.registerForEvent(p(l.tDhr.AgrI.et)+"___"+t,r.bOFa)})))}else u.unregisterFromEvent(v(f.bHkN)+"___"+f.tDhr.WfoJ,r),u.registerForEvent(v(l.bHkN)+"___"+l.tDhr.WfoJ,r);r.VLCE[n]=Date.now()}})),u(this,"RZgj",(function(t,e,n,i){var a=H.getInstance();v(r.EEsW.bHkN)===t&&r.lxsL(n,r.EEsW.Tdeq)&&r.EEsW.tDhr.WfoJ===e&&r.yQHW(r.EEsW.tDhr.AgrI,i)&&(r.TlEF+=1,r.Ggeo=r.VhNV(r.TlEF,r.EEsW.RaJi,r.EEsW.johA),r.Ggeo&&(r.EEsW.eVZp=n,a.validateForTermination(r.lWMY,r.mDQO)))})),u(this,"AiId",(function(t,e,n,i){var a=r.JNJC.QAFb;return v(a.bHkN)===t&&a.tDhr.WfoJ===e&&r.lxsL(n,a.Tdeq)&&r.yQHW(a.tDhr.AgrI,i)})),u(this,"lxsL",(function(t,e){var r=Math.ceil(t);return r>e.CJQD&&r<e.XFiM})),u(this,"VhNV",(function(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(i&&r.JNJC.UsFI&&(t+=r.SYdV),n){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;default:return!1}})),u(this,"yQHW",(function(t,e){var r=!0;try{var n,a=function(){if(!e[o]||!1===r)return{v:!1};if("object"===i(t[o])){var n,a=t[o].op,s=t[o].t;"s"===s?n=t[o].val:"l"!==s&&"f"!==s||(n=parseFloat(t[o].val));var u=(Array.isArray(e[o])?e[o]:[e[o]]).some((function(t){return g(t,n,a)}));r=r&&u}else r=r&&g(e[o],t[o],"EQ")};for(var o in t)if(n=a())return n.v}catch(t){F.error(t),r=!1}return r}))}return s(e,[{key:"_displayCampaign",value:function(t){var e=H.getInstance();this.Ggeo=!0,this.Ggeo&&(this.TlEF+=1,this.Ggeo=this.VhNV(this.TlEF,this.JNJC.RaJi,this.JNJC.johA),this.Ggeo&&(this.JNJC.eVZp=t,e.validate(this.lWMY,this.mDQO)))}}]),e}(),M=window.ApxorLogger,O=s((function e(){var r=this;a(this,e),u(this,"qcoc",[]),u(this,"_ret_day",{}),u(this,"nlKI",{}),u(this,"JHpf",!1),u(this,"DlYa",!1),u(this,"retainedDaysValidated",!0),u(this,"retainedSessionValidated",!0),u(this,"eventDoneInLT",!1),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{r.qcoc=t.overall_cfg.events,r._ret_day=t.overall_cfg.ret_day,r.nlKI=t.overall_cfg.session,r.JHpf=t.overall_cfg.toggleRetDay,r.DlYa=t.overall_cfg.toggleSession}catch(t){return M.error(t),!1}return!0})),u(this,"validate",(function(){var e=parseInt(t.getController().getFromStorage("apx_retained_days")),n=parseInt(t.getController().getFromStorage("apx_retained_session"));if(r.JHpf&&!isNaN(e)&&!(e>=r._ret_day.from&&e<=r._ret_day.to))return r.retainedDaysValidated=!1,!1;if(r.DlYa&&!isNaN(n)&&!(n>=r.nlKI.from&&n<=r.nlKI.to))return r.retainedSessionValidated=!1,!1;try{for(var i=t.getController().getFromStorage("_apx_lt_count"),a=t.getSiteId(),o=JSON.parse((new TextDecoder).decode(function(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return e}(h(a,i)))),s=0;s<r.qcoc.length;s++){if(o[r.qcoc[s].name.replace("'","").replace("’","")])return r.eventDoneInLT=!0,!1}}catch(t){M.error("Failed to validate the lt count:"+t)}return!0}))})),R=window.ApxorLogger,I=s((function t(){var e=this;a(this,t),u(this,"lybV",[]),u(this,"YFoC",[]),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.lybV=t.attributes.user,e.YFoC=t.attributes.session,!Array.isArray(e.lybV)||!Array.isArray(e.YFoC))return R.error("No attributes"),!1}catch(t){return R.error(t),!1}return!0})),u(this,"validate",(function(t,r){return e.USQe(t,e.lybV)&&e.USQe(r,e.YFoC)})),u(this,"USQe",(function(t,e){var r=e.length,n=!0;try{for(var i,a=function(){var r=e[o];if(!t[r.name]||!1===n)return{v:!1};var i=r.operator,a=r.type,s=r.value.map((function(t){return"s"===a?t:"l"===a?parseInt(t):"f"===a?parseFloat(t):void 0})),u=(Array.isArray(t[r.name])?t[r.name]:[t[r.name]]).some((function(t){return s.some((function(e){return g(t,e,i)}))}));n=n&&u},o=0;o<r;o++)if(i=a())return i.v}catch(t){R.error(t),n=!1}return n}))})),Q=s((function e(){var r=this;a(this,e),u(this,"LKAA",t.getController()),u(this,"type",""),u(this,"_duration_seconds",0),u(this,"uwmT",1),u(this,"parse",(function(t){try{var e,n,i;if(r.vZJD=null===(e=t.terminate_info.time_based)||void 0===e?void 0:e.type,r._duration_seconds=null===(n=t.terminate_info)||void 0===n?void 0:n.time_based.duration_seconds,r.uwmT=null===(i=t.terminate_info.time_based)||void 0===i?void 0:i.days,r.KEqN(t._id))return r.LKAA.persistTerminationInfoLocally(t._id),!1}catch(t){return!1}return!0})),u(this,"KEqN",(function(t){var e,n=JSON.parse(r.LKAA.getFromStorage("apx_termination_ID"));if(!n[t]||null===(e=n[t])||void 0===e||!e.startDate)return!1;var i,a=new Date(n[t].startDate),o=new Date((i=new Date).getMonth()+"/"+i.getDate()+"/"+i.getFullYear()),s=parseInt((o-a)/864e5,10),u=function(){var t=new Date;return{hours:t.getHours(),mins:t.getMinutes()}}(),l=n[t].gvOT;return s===r.uwmT&&u.hours>=l.hours||s>r.uwmT||n[t].goalAcheived}))})),Z=s((function t(){var e=this;a(this,t),u(this,"enable_goal_events",!1),u(this,"attributes",{}),u(this,"BiFk",new I),u(this,"qcsT",new Q),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r,n,i;if(e.enable_time_based=null==t||null===(r=t.terminate_info)||void 0===r?void 0:r.enable_time_based,e.enable_time_based&&!e.qcsT.parse(t))return!1;if(e.enable_goal_events=null==t||null===(n=t.terminate_info)||void 0===n?void 0:n.enable_goal_events,e.enable_attributes=null==t||null===(i=t.terminate_info)||void 0===i?void 0:i.enable_attributes,e.enable_attributes&&!e.BiFk.parse(t.terminate_info))return!1}catch(t){return window.ApxorLogger.error(t),!1}return!0})),u(this,"validate",(function(t,r){return e.BiFk.validate(t,r)}))})),G=window.ApxorLogger,L=s((function e(){var n=this;a(this,e),u(this,"TfZl",[]),u(this,"uWZe",[]),u(this,"lWMY",""),u(this,"Vmqf",new V),u(this,"zQql",new E),u(this,"ctYe",new w),u(this,"RTDy",new b),u(this,"YiTx",new O),u(this,"ugdM",new Z),u(this,"sfuy",!1),u(this,"zHXB",[]),u(this,"_variant_code",""),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e;if(!c(t._id))return G.error("No Id"),!1;if(!c(t.enabled)||!t.enabled)return G.error("Not enabled"),!1;if(!(n.Vmqf.parse(t)&&n.ctYe.parse(t)&&n.RTDy.parse(t)&&n.zQql.parse(t)&&n.YiTx.parse(t)&&n.ugdM.parse(t)))return!1;if(n._variant_code=n.Vmqf._isExperiment||n.Vmqf._only_context?null===(e=n.Vmqf._attr)||void 0===e?void 0:e.apx_variant_code:"TG",!c(t.conditions)||!Array.isArray(t.conditions))return G.error("No valid conditions",t.conditions),!1;n.lWMY=t._id,n.sfuy=!!c(t.sequence_enabled)&&t.sequence_enabled,n.sfuy&&t.conditions.sort((function(t,e){return t.sequence<e.sequence}));for(var r=t.conditions,i=r.length,a=0;a<i;a++){n.zHXB=[];var o=r[a];if("didn't"===o.type){var s,u={trigger_key:o.trigger.details.name,no_kpi_array:null==o||null===(s=o.details)||void 0===s||null===(s=s.additional_info)||void 0===s?void 0:s.nkpi,condition_id:null==o?void 0:o._id,time_bounds:o.time_bounds.upper};n.zHXB=[].concat(l(n.zHXB),[u])}var f=new Y;f.initialize(o,n.lWMY,a,n.sfuy,n.zHXB)&&n.TfZl.push(f)}if(n.ugdM.enable_goal_events)for(var d=t.terminate_info.goal_events.events,_=d.length,h=0;h<_;h++){var v=new Y;v.initialize(d[h],n.lWMY,h,!0,[],"termination")&&n.uWZe.push(v)}return n.TfZl.length>0}catch(t){return G.error(t),!1}})),u(this,"vdyF",(function(t){if(!(t<0))if(n.sfuy){var e=n.TfZl[t];if(c(e)&&e.Ggeo){var r=n.TfZl[t-1];if(c(r)&&!r.Ggeo)return;var i=n.TfZl[t+1];c(i)?i.xHpZ():n.EJaa()}}else n.EJaa()})),u(this,"vITK",(function(t){t<0||n.zkzJ()})),u(this,"EJaa",(function(){var e,i,a=t.getController().getUserAttributes(),o=t.getController().getSessionAttributes();if(null!==(e=window.ApxorRTM)&&void 0!==e&&e.isBadgePresent&&null!==(i=window.ApxorRTM)&&void 0!==i&&i.badgesLists.includes(n.lWMY)&&t.getController().isBadgeTriggerSatisfied(n.lWMY)||null==t||t.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===n.Vmqf.vZJD?"survey":"campaign",apx_nudge_id:n.lWMY,apx_nudge_name:n.Vmqf.WfoJ,apx_variant_code:n.Vmqf._isExperiment||n.Vmqf._only_context?n.Vmqf._attr.apx_variant_code:"TG"}),!n.ctYe.validate()||!n.zQql.validate(a,o)||!n.YiTx.validate())return n.YiTx.retainedDaysValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.Vmqf.vZJD?"survey":"campaign",apx_nudge_id:n.lWMY,apx_nudge_name:n.Vmqf.WfoJ,apx_variant_code:n.Vmqf._isExperiment||n.Vmqf._only_context?n.Vmqf._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Retained day criteria not met"}),n.YiTx.retainedSessionValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.Vmqf.vZJD?"survey":"campaign",apx_nudge_id:n.lWMY,apx_nudge_name:n.Vmqf.WfoJ,apx_variant_code:n.Vmqf._isExperiment||n.Vmqf._only_context?n.Vmqf._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"User session criteria not met"}),n.YiTx.eventDoneInLT&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.Vmqf.vZJD?"survey":"campaign",apx_nudge_id:n.lWMY,apx_nudge_name:n.Vmqf.WfoJ,apx_variant_code:n.Vmqf._isExperiment||n.Vmqf._only_context?n.Vmqf._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Event done in life time"})),n.zQql.userAttributesValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.Vmqf.vZJD?"survey":"campaign",apx_nudge_id:n.lWMY,apx_nudge_name:n.Vmqf.WfoJ,apx_variant_code:n.Vmqf._isExperiment||n.Vmqf._only_context?n.Vmqf._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"User property filter not met"}),n.zQql.sessionAttributeValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.Vmqf.vZJD?"survey":"campaign",apx_nudge_id:n.lWMY,apx_nudge_name:n.Vmqf.WfoJ,apx_variant_code:n.Vmqf._isExperiment||n.Vmqf._only_context?n.Vmqf._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Session property filter not met"}),n.ctYe._not_in_specified_time&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.Vmqf.vZJD?"survey":"campaign",apx_nudge_id:n.lWMY,apx_nudge_name:n.Vmqf.WfoJ,apx_variant_code:n.Vmqf._isExperiment||n.Vmqf._only_context?n.Vmqf._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"current time doesn't fall in the specified times"})),n.ctYe._not_yet_active&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.Vmqf.vZJD?"survey":"campaign",apx_nudge_id:n.lWMY,apx_nudge_name:n.Vmqf.WfoJ,apx_variant_code:n.Vmqf._isExperiment||n.Vmqf._only_context?n.Vmqf._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"nudge not yet active"})),void(n.ctYe._nudge_expired&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.Vmqf.vZJD?"survey":"campaign",apx_nudge_id:n.lWMY,apx_nudge_name:n.Vmqf.WfoJ,apx_variant_code:n.Vmqf._isExperiment||n.Vmqf._only_context?n.Vmqf._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"nudge expired"})));for(var s=n.TfZl.length,u=s<1,l="",f=0;f<s;f++){var c=n.TfZl[f],d=c.Ggeo;if(""===l.trim())u=d;else switch(l){case"AND":u=u&&d;break;case"OR":u=u||d}l=c.Wodi}if(u){if(console.debug("onCondition satisfied"),!n.RTDy.ZREd(n.lWMY))return console.warn("Maximum limit reached",n.lWMY),void(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===n.Vmqf.vZJD?"survey":"campaign",apx_nudge_id:n.lWMY,apx_nudge_name:n.Vmqf.WfoJ,apx_variant_code:n.Vmqf._isExperiment||n.Vmqf._only_context?n.Vmqf._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Campaign limit reached"}));console.log("Dispatching event",n.Vmqf.vZJD),t.logEvent("apx_context_evaluated",r(r({apx_nudge_type:"SURVEY"===n.Vmqf.vZJD?"survey":"campaign",apx_nudge_id:n.lWMY,apx_nudge_name:n.Vmqf.WfoJ,apx_variant_code:n.Vmqf._isExperiment||n.Vmqf._only_context?n.Vmqf._attr.apx_variant_code:"TG"},n.Vmqf._attr),{},{message_name:n.Vmqf.WfoJ,id:n.lWMY})),t.getController().dispatchEvent(n.Vmqf.vZJD,{name:n.Vmqf.vZJD,additional_info:{uuid:n.lWMY,name:n.Vmqf.WfoJ}})}})),u(this,"zkzJ",(function(){for(var e=n.uWZe.length,i=e<1,a="",o=0;o<e;o++){var s=n.uWZe[o],u=s.Ggeo;if(""===a.trim())i=u;else switch(a){case"AND":i=i&&u;break;case"OR":i=i||u}a=s.CchN}i&&(console.log("Dispatching event",n.Vmqf.vZJD),t.getController().persistTerminationInfoLocally(n.lWMY),!0===n.Vmqf._only_context&&t.logEvent("apx_context_evaluated",r(r({},n.Vmqf._attr),{},{message_name:n.Vmqf.WfoJ,id:n.lWMY})),t.getController().dispatchEvent(n.Vmqf.vZJD,{name:n.Vmqf.vZJD,additional_info:{uuid:n.lWMY,name:n.Vmqf.WfoJ}}))})),u(this,"validateForTerminationAttributes",(function(){var e=t.getController().getUserAttributes(),r=t.getController().getSessionAttributes();return n.ugdM.validate(e,r)})),u(this,"SPyM",(function(){n.RTDy.SPyM()})),u(this,"getFrequencyCount",(function(){return n.RTDy.getFrequencyCount()})),u(this,"KHTJ",(function(){return n.RTDy.gpbQ()}))})),U=s((function t(){var e=this;a(this,t),u(this,"KQfY",{}),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(c(t)&&c(t.configs)){var r=t.configs;if(!Array.isArray(r))return;r.sort((function(t,e){var r,n;return(null!==(r=t.prio)&&void 0!==r?r:-1)-(null!==(n=e.prio)&&void 0!==n?n:-1)}));for(var n=0;n<r.length;n++){var i=r[n],a=i._id,o=new L;o.parse(i)?e.KQfY[a]=o:console.warn("Failed to parse cfg",a)}}})),u(this,"validate",(function(t,r){e.KQfY[t]&&e.KQfY[t].vdyF(r)})),u(this,"getVariantCode",(function(t){return e.KQfY[t]?e.KQfY[t]._variant_code:""})),u(this,"validateForTermination",(function(t,r){e.KQfY[t]&&e.KQfY[t].vITK(r)})),u(this,"validateForTerminationAttributes",(function(t){return!!e.KQfY[t]&&e.KQfY[t].validateForTerminationAttributes()})),u(this,"SPyM",(function(t){e.KQfY[t].SPyM()})),u(this,"getFrequencyCount",(function(t){return e.KQfY[t].getFrequencyCount()})),u(this,"resetFrequencyCounts",(function(){var t=e.KQfY;for(var r in t)t[r].KHTJ()})),u(this,"OkRS",(function(t){try{if(e.KQfY){var r=e.KQfY[t];if(r&&r.Vmqf)return r.Vmqf}}catch(t){console.log("Error in getting the campaign meta ".concat(t))}return{}}))})),P=window.ApxorLogger,k=s((function e(){var r=this;a(this,e),u(this,"Ergd",{}),u(this,"NoCX",[]),u(this,"KLaT",!1),u(this,"initialize",(function(){var e=t.getController();e.registerForEvent("APP_EVENT",(function(t){return r.quqR(t,"AE")})),e.registerForEvent("CLIENT_EVENT",(function(t){return r.quqR(t,"CE")}))})),u(this,"XbPX",(function(){for(var t in r.NoCX)r.rqxO(t.event,t.key,t.type);r.KLaT=!0})),u(this,"WAQc",(function(t,e){var n;"function"==typeof e&&((n=r.Ergd[t]?r.Ergd[t]:[]).push(e),r.Ergd[t]=n,P.debug("Listeners list: ",r.Ergd))})),u(this,"unregisterFromEvent",(function(t,e){if(r.Ergd[t]){for(var n=r.Ergd[t],i=[],a=0;a<n.length;a++){var o=n[a];o!==e&&i.push(o)}r.Ergd[t]=i}})),u(this,"quqR",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE",n=e+"___"+t.name;r.rqxO(t,n,e)})),u(this,"rqxO",(function(e,n,i){if(r.KLaT){if(P.debug("Notifying listeners for event: "+e+", "+n,r.Ergd),r.Ergd[n])for(var a=r.Ergd[n],o=t.getController().getSDKRunningTimeInSec(),s=0;s<a.length;s++){(0,a[s])(i,e.name,o,e.additional_info)}}else r.NoCX.push({event:e,key:n,type:i})}))})),j=window.ApxorLogger,H=function(){function e(){var r=this;return a(this,e),u(this,"Vbnp",!1),u(this,"PVfu",null),u(this,"csGV",y()),u(this,"dFCM",new k),u(this,"vPyD",t.getSiteId()),u(this,"wMUr",{}),u(this,"getQeState",(function(){try{var e=t.getController().getFromStorage("qe_state");return e?JSON.parse(h(r.vPyD,e)):(r.wMUr={},r.setQeState())}catch(t){return r.wMUr={},r.setQeState()}})),u(this,"setQeState",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{t.getController().persistToStorage("qe_state",r.wMUr,!0)}catch(n){""===e?r.wMUr={}:r.wMUr[e]={SESSION:0,OVERALL:0,DATES:{}},t.getController().persistToStorage("qe_state",r.wMUr,!0)}return r.wMUr})),u(this,"initialize",(function(){r.Vbnp||(r.Vbnp=!0,r.PVfu=new U,r.dFCM.initialize(),r.wMUr=r.getQeState(),j.info("QE Initialized.."))})),u(this,"parse",(function(t){r.iJAz()?(r.PVfu.parse(t),r.dFCM.XbPX()):j.warn("Must call init first. Unable to proceed")})),u(this,"validate",(function(t,e){r.iJAz()&&r.PVfu.validate(t,e)})),u(this,"getVariantCode",(function(t){return r.PVfu.getVariantCode(t)})),u(this,"validateForTermination",(function(t,e){r.iJAz()&&r.PVfu.validateForTermination(t,e)})),u(this,"validateForTerminationAttributes",(function(t,e){return r.PVfu.validateForTerminationAttributes(t,e)})),u(this,"updateCount",(function(t){try{c(r.wMUr[t])||r.createObjConfig(t),r.incrementFrequencies(t),r.setQeState(t),r.PVfu.SPyM(t)}catch(t){console.log("Could not update the count config:".concat(t))}})),u(this,"resetFrequencyCounts",(function(){r.PVfu.resetFrequencyCounts()})),u(this,"getFrequencyCount",(function(t){return r.PVfu.getFrequencyCount(t)})),u(this,"registerForEvent",(function(t,e){r.dFCM.WAQc(t,e)})),u(this,"unregisterFromEvent",(function(t,e){r.dFCM.unregisterFromEvent(t,e)})),u(this,"notifyEventListener",(function(t){r.dFCM.quqR(t)})),u(this,"fetch",(function(e,r,n,i){t.getController().fetchConfiguration(e,r,n,i)})),u(this,"iJAz",(function(){return r.Vbnp})),u(this,"getCampaignMetaFromQueryEngine",(function(t){return r.PVfu.OkRS(t)})),u(this,"htlQ",(function(){return r.csGV})),e.instance||(e.instance=this),e.instance}return s(e,[{key:"createObjConfig",value:function(t){try{this.wMUr=this.getQeState(),c(this.wMUr[t])||(this.wMUr[t]={SESSION:0,OVERALL:0,DATES:{}},this.csGV&&(this.wMUr[t].DATES[this.csGV]=0),this.setQeState(t))}catch(t){j.error("Can not create the frequency count object:"+t)}}},{key:"incrementFrequencies",value:function(t){this.wMUr=this.getQeState();var e=this.wMUr[t];e.SESSION=e.SESSION+1,e.OVERALL=e.OVERALL+1;var r=y();r===this.csGV&&e.DATES&&e.DATES[r]||(this.csGV=r,e.DATES={},e.DATES[this.csGV]=0),e.DATES[this.csGV]=e.DATES[this.csGV]+1}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();u(H,"instance",void 0),window.ceVersion=151;try{void 0===exports&&null===exports||(exports.default=H,module.exports=exports.default)}catch(t){}return H}));
