!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],e):(t=t||self)["apxor-qe"]=e(t.Apxor)}(this,(function(t){"use strict";function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){u(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function r(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i)}}function s(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e,n){return(e=r(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var f=function(t){return void 0!==t&&!function(t){return null===t}(t)},v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function d(t,e){return Array.from(e).map((function(e,n){return String.fromCharCode(e^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,n))})).join("")}var _=function(t,e){return d(t,e=function(t){var e,n,r,i,a,o,s=0,u=[];if(!t)return t;t+="";do{e=(o=v.indexOf(t.charAt(s++))<<18|v.indexOf(t.charAt(s++))<<12|(i=v.indexOf(t.charAt(s++)))<<6|(a=v.indexOf(t.charAt(s++))))>>16&255,n=o>>8&255,r=255&o,u.push(e),64!==i&&(u.push(n),64!==a&&u.push(r))}while(s<t.length);return u}(e))},p=function(t){switch(t){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE"}return"Unknown"},h=function(t){return t.toUpperCase()},g=function(t,e,n){switch(n){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;case"NEQ":return t!==e;case"R":return y(e).test(t);default:return!1}},y=function(t){var e=t.replace(/.*\/([gimuy]*)$/,"$1");e===t&&(e="");var n=e?t.replace(new RegExp("^/(.*?)/"+e+"$"),"$1"):t;return new RegExp(n,e)},m=function(){var t=new Date;return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()},x=window.ApxorLogger,Q=s((function e(){var n=this;a(this,e),u(this,"ZTry","ALL"),u(this,"Scfk",[]),u(this,"kNXD",[]),u(this,"userAttributesValidated",!0),u(this,"sessionAttributeValidated",!0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(n.ZTry=t.audience.audience_type,n.Scfk=t.audience.attributes.user,n.kNXD=t.audience.attributes.session,!Array.isArray(n.Scfk)||!Array.isArray(n.kNXD))return x.error("No attributes"),!1}catch(t){return x.error(t),!1}return!0})),u(this,"validate",(function(e,r){var i=!0;"FTU"===n.ZTry&&(i=t.getController().getSessionInfo().is_first_session);var a=n.qXuh(e,n.Scfk),o=n.qXuh(r,n.kNXD);return a||(n.userAttributesValidated=!1),o||(n.sessionAttributeValidated=!1),i&&a&&o})),u(this,"qXuh",(function(t,e){var n=e.length,r=!0;try{for(var i,a=function(){var n=e[o];if(void 0===t[n.name]||!1===r)return{v:!1};var i=n.operator,a=n.type,s=n.value.map((function(t){if("s"===a)return t;if("l"===a)return parseInt(t);if("f"===a)return parseFloat(t);if("b"===a)switch(t){case"true":return!0;case"false":return!1}})),u=(Array.isArray(t[n.name])?t[n.name]:[t[n.name]]).some((function(t){return s.some((function(e){return"s"===a?t="".concat(t):"l"===a?t=parseInt(t):"f"===a?t=parseFloat(t):"b"===a&&(t=!!t),g(t,e,i)}))}));r=r&&u},o=0;o<n;o++)if(i=a())return i.v}catch(t){x.error(t),r=!1}return r}))})),O=window.ApxorLogger,S=s((function t(){var e=this;a(this,t),u(this,"WaXV",0),u(this,"yhQv",0),u(this,"xSgW","SESSION"),u(this,"wmsV",0),u(this,"Wpwo",0),u(this,"JkjC",0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.WaXV=t.frequency.count,-1===e.WaXV&&(e.WaXV=1e3),e.JkjC=e.WaXV,e.yhQv=t.frequency.time_interval,e.xSgW=t.frequency.validity,e.Wpwo=t.frequency.ses_lmt,e._dayCount=t.frequency.day_lmt;var n=U.getInstance().getQeState();if(!f(n)||!f(n[t._id]))return!0;if("SESSION"===e.xSgW){if(e.WaXV=parseInt(e.WaXV)-parseInt(n[t._id].SESSION),e.WaXV<=0)return console.warn("Max count limit reached for session:"+t._id),!1}else{if("OVERALL"!==e.xSgW)return O.info("Invalid config."),!1;if(e.WaXV=parseInt(e.WaXV)-parseInt(n[t._id].OVERALL),e.WaXV<=0)return console.warn("Max count limit reached for overall:"+t._id),!1}}catch(t){return O.error(t),!1}return!0})),u(this,"KkRA",(function(){e.WaXV=e.WaXV-1})),u(this,"getFrequencyCount",(function(){return e.WaXV})),u(this,"mOhO",(function(){"SESSION"===e.xSgW&&(e.WaXV=e.JkjC,O.info("Campaign Limit reset"))})),u(this,"jNxU",(function(t){try{if(e.WaXV<=0)return!1;var n=U.getInstance().getQeState();if(!f(n)||!f(n[t]))return!0;if(0!==e.Wpwo)if(parseInt(e.Wpwo)-parseInt(n[t].SESSION)<=0)return!1;if(0!==e._dayCount){var r,i=m();if(parseInt(e._dayCount)-parseInt((null===(r=n[t])||void 0===r?void 0:r.DATES[i])||0)<=0)return!1}}catch(t){O.error("Error validating the frequency:"+t)}return!0}))})),A=s((function t(){var e=this;a(this,t),u(this,"xugs",""),u(this,"ZTry",""),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,r;e.xugs=t.meta.name,e.ZTry=t.meta.type,e._only_context=t.meta.only_context,e._attr=(null===(n=t.meta)||void 0===n?void 0:n.attr)||{},e._isExperiment=null===(r=t.meta)||void 0===r?void 0:r.isExperiment}catch(t){return window.ApxorLogger.error(t),!1}return!0}))})),w=window.ApxorLogger,E=s((function t(){var e=this;a(this,t),u(this,"hkda",-1),u(this,"dwBM",-1),u(this,"CTVx",-1),u(this,"GltF",-1),u(this,"cWEo",!1),u(this,"_nudge_expired",!1),u(this,"_not_yet_active",!1),u(this,"_not_in_specified_time",!1),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(t.validity.start_date))||isNaN(Date.parse(t.validity.end_date)))return w.error("Not valid dates"),!1;if(e.hkda=Date.parse(t.validity.start_date),e.dwBM=Date.parse(t.validity.end_date),f(t.at_specific_time)&&(e.cWEo=t.at_specific_time,e.cWEo&&f(t.time_limits))){var n=(new Date).toISOString().split("T")[0];if(e.CTVx=Date.parse(n+"T"+t.time_limits.start_time+".000Z"),e.GltF=Date.parse(n+"T"+t.time_limits.end_time+".000Z"),isNaN(e.CTVx)||isNaN(e.GltF))return w.error("Not valid times"),!1}}catch(t){return w.error(t),!1}return!0})),u(this,"validate",(function(){var t=Date.now();return t>e.hkda&&t<e.dwBM?(!e.cWEo||t>=e.CTVx&&t<=e.GltF||(e._not_in_specified_time=!0),!e.cWEo||t>=e.CTVx&&t<=e.GltF):(t<e.hkda?e._not_yet_active=!0:t>e.dwBM&&(e._nudge_expired=!0),!1)}))})),T=s((function t(){var e=this;a(this,t),u(this,"xugs",""),u(this,"uyBO",{}),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.xugs=t.name,e.uyBO=t.additional_info}catch(t){return!1}return!0}))})),b=s((function t(){var e=this;a(this,t),u(this,"BtDO",0),u(this,"ahuB",0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.BtDO=Number(t.lower),e.ahuB=Number(t.upper),isNaN(e.BtDO)||isNaN(e.ahuB))return!1}catch(t){return!1}return!0}))})),Y=s((function t(){var e=this;a(this,t),u(this,"YYzQ",0),u(this,"EGvA",""),u(this,"ESTf",""),u(this,"KzWv",new T),u(this,"SVGp",new b),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.EGvA=t.event_type,e.ESTf=t.activity,e.KzWv.parse(t.details)&&e.SVGp.parse(t.time_bounds)}catch(t){return!1}}))})),K=window.ApxorLogger,W=s((function t(){var e=this;a(this,t),u(this,"YYzQ",0),u(this,"iqSt",-1),u(this,"WaXV",0),u(this,"wYWa",""),u(this,"ESTf",""),u(this,"EGvA",""),u(this,"SVGp",new b),u(this,"KzWv",new T),u(this,"cmpw",new Y),u(this,"NkOp","AND"),u(this,"pAbg",!1),u(this,"ZTry",void 0),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.iqSt=t.sequence,e.WaXV=t.count_config.count,e.wYWa=t.count_config.operator,e.ESTf=t.activity,e.EGvA=t.event_type,e.NkOp=t.combine_operator,e.ZTry=t.type,e.KzWv.parse(t.details)&&e.cmpw.parse(t.trigger)&&e.SVGp.parse(t.time_bounds)}catch(t){return K.error(t),!1}}))})),V=window.ApxorLogger,C=s((function t(){var e=this;a(this,t),u(this,"WaXV",0),u(this,"wYWa",""),u(this,"EGvA",""),u(this,"SVGp",new b),u(this,"KzWv",new T),u(this,"NkOp","AND"),u(this,"parse",(function(t){try{return e.WaXV=t.count_config.count,e.wYWa=t.count_config.operator,e.EGvA=t.event_type,e.NkOp=t.combine_operator,e.KzWv.parse(t.details)&&e.SVGp.parse(t.time_bounds)}catch(t){return V.error(t),!1}}))})),G=window.ApxorLogger,k=function(){function e(){var n=this;a(this,e),u(this,"sZUo",0),u(this,"iOKC",""),u(this,"KfWe",new W),u(this,"tomJ",new C),u(this,"Xdur",!1),u(this,"eTZi",!1),u(this,"Pkpz",0),u(this,"NkOp","AND"),u(this,"QFSA","OR"),u(this,"zbqT",-1),u(this,"vngA",[]),u(this,"vOQA",{}),u(this,"kkgw",!1),u(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(n.iOKC=r,n.Pkpz=i,n.vngA=o,"termination"===s&&""!==s){n.tomJ.parse(e);return n.QFSA=n.tomJ.NkOp,n.wzyB(),!0}var u=n.KfWe.parse(e);if(u){if(n.NkOp=n.KfWe.NkOp,n.KfWe.pAbg){var c=n.KfWe.KzWv.xugs;"APX_PAGE_OPENED"===c&&(c=n.KfWe.KzWv.uyBO.navigation_id,c=f(c)?c:n.KfWe.KzWv.xugs),n.zbqT=t.getController().getEventCount(c);var l=n.KfWe.WaXV,v=n.KfWe.wYWa;if(n.eTZi=n.yiKD(n.zbqT-1,l,v,!1),n.Xdur=n.eTZi,n.eTZi&&"APX_PAGE_OPENED"===n.KfWe.KzWv.xugs)return!0}return a&&0!==i||n.vFAI(),!0}return!1})),u(this,"vFAI",(function(){var t,e=n.KfWe,r=e.cmpw,i=U.getInstance();"app_start"===r.EGvA?(n.Xdur=!0,i.registerForEvent(p(e.EGvA)+"___"+e.KzWv.xugs,n.DXVx)):i.registerForEvent(p(e.EGvA)+"___"+r.KzWv.xugs,n.DXVx),null!==(t=window.ApxorRTM)&&void 0!==t&&t.badgesLists.includes(n.iOKC)&&i.registerForEvent(p(e.EGvA)+"___"+"apxor-badge-container-".concat("-".concat(n.iOKC).replaceAll(" ","").replace(/[^\w\s]/gi,"")),n.DXVx)})),u(this,"wzyB",(function(){var t=n.tomJ,e=U.getInstance();n.Xdur=!0,e.registerForEvent(p(t.EGvA)+"___"+t.KzWv.xugs,n.yvYT)})),u(this,"VZvO",(function(t,e,r,i){var a,o=(Date.now()-n.vOQA[e])/1e3;(null===(a=n.KfWe)||void 0===a||null===(a=a.KzWv)||void 0===a||null===(a=a.uyBO)||void 0===a?void 0:a.time)/1e3>o&&n._displayCampaign(r)})),u(this,"tbOM",(function(t,e,r,i){var a,o;n.kkgw=!0;var s=Date.now(),u=null===(a=n.KfWe)||void 0===a||null===(a=a.cmpw)||void 0===a?void 0:a.KzWv.xugs,c=(s-n.vOQA[u])/1e3,l=null===(o=n.KfWe)||void 0===o||null===(o=o.KzWv)||void 0===o||null===(o=o.uyBO)||void 0===o?void 0:o.time;(l/=1e3)>c&&n._displayCampaign(r)})),u(this,"DXVx",(function(e,r,i,a){var o,s,u=U.getInstance();if(n.Xdur){if(null!==(o=window.ApxorRTM)&&void 0!==o&&o.isBadgePresent&&null!==(s=window.ApxorRTM)&&void 0!==s&&s.badgesLists.includes(n.iOKC)&&t.getController().isBadgeTriggerSatisfied(n.iOKC))return n.eTZi=!0,n.KfWe.YYzQ=i,void u.validate(n.iOKC,n.Pkpz);p(n.KfWe.EGvA)===e&&n.KBBz(i-n.KfWe.cmpw.YYzQ,n.KfWe.SVGp)&&n.KfWe.KzWv.xugs===r&&n.abiD(n.KfWe.KzWv.uyBO,a)&&(n.sZUo+=1,n.eTZi=n.yiKD(n.sZUo,n.KfWe.WaXV,n.KfWe.wYWa),n.eTZi&&(n.KfWe.YYzQ=i,u.validate(n.iOKC,n.Pkpz)))}else if(n.Xdur=n.zMPO(e,r,i,a),n.Xdur){var c=n.KfWe,l=c.cmpw;if(l.YYzQ=i,"activity_time"===(null==c?void 0:c.EGvA)){var f,v,d,_=null==c||null===(f=c.KzWv)||void 0===f||null===(f=f.uyBO)||void 0===f?void 0:f.time;(null==c||null===(v=c.KzWv)||void 0===v||null===(v=v.uyBO)||void 0===v?void 0:v.nkpi.length)>0&&(setTimeout((function(){n.kkgw||(n.eTZi=!0,n.eTZi&&(n.sZUo+=1,n.eTZi=n.yiKD(n.sZUo,n.KfWe.WaXV,n.KfWe.wYWa),n.eTZi&&(n.KfWe.YYzQ=i,u.validate(n.iOKC,n.Pkpz)))),c.KzWv.uyBO.nkpi.map((function(t){u.unregisterFromEvent(h(c.KzWv.uyBO.et)+"___"+t,n)}))}),_),c.KzWv.uyBO.nkpi.map((function(t){u.registerForEvent(h(c.KzWv.uyBO.et)+"___"+t,n.tbOM)}))),(null==c||null===(d=c.KzWv)||void 0===d||null===(d=d.uyBO)||void 0===d?void 0:d.kpi.length)>0&&(setTimeout((function(){c.KzWv.uyBO.kpi.map((function(t){u.unregisterFromEvent(h(c.KzWv.uyBO.et)+"___"+t,n)}))}),_),c.KzWv.uyBO.kpi.map((function(t){t===c.cmpw.KzWv.xugs?(u.unregisterFromEvent(p(l.EGvA)+"___"+l.KzWv.xugs,n),u.registerForEvent(h(c.KzWv.uyBO.et)+"___"+t,n.VZvO)):u.registerForEvent(h(c.KzWv.uyBO.et)+"___"+t,n.tbOM)})))}else u.unregisterFromEvent(p(l.EGvA)+"___"+l.KzWv.xugs,n),u.registerForEvent(p(c.EGvA)+"___"+c.KzWv.xugs,n);n.vOQA[r]=Date.now()}})),u(this,"yvYT",(function(t,e,r,i){var a=U.getInstance();p(n.tomJ.EGvA)===t&&n.KBBz(r,n.tomJ.SVGp)&&n.tomJ.KzWv.xugs===e&&n.abiD(n.tomJ.KzWv.uyBO,i)&&(n.sZUo+=1,n.eTZi=n.yiKD(n.sZUo,n.tomJ.WaXV,n.tomJ.wYWa),n.eTZi&&(n.tomJ.YYzQ=r,a.validateForTermination(n.iOKC,n.Pkpz)))})),u(this,"zMPO",(function(t,e,r,i){var a=n.KfWe.cmpw;return p(a.EGvA)===t&&a.KzWv.xugs===e&&n.KBBz(r,a.SVGp)&&n.abiD(a.KzWv.uyBO,i)})),u(this,"KBBz",(function(t,e){var n=Math.ceil(t);return n>e.BtDO&&n<e.ahuB})),u(this,"yiKD",(function(t,e,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(i&&n.KfWe.pAbg&&(t+=n.zbqT),r){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;default:return!1}})),u(this,"abiD",(function(t,e){var n=!0;try{var r,a=function(){if(!e[o]||!1===n)return{v:!1};if("object"===i(t[o])){var r,a=t[o].op,s=t[o].t;"s"===s?r=t[o].val:"l"!==s&&"f"!==s||(r=parseFloat(t[o].val));var u=(Array.isArray(e[o])?e[o]:[e[o]]).some((function(t){return g(t,r,a)}));n=n&&u}else n=n&&g(e[o],t[o],"EQ")};for(var o in t)if(r=a())return r.v}catch(t){G.error(t),n=!1}return n}))}return s(e,[{key:"_displayCampaign",value:function(t){var e=U.getInstance();this.eTZi=!0,this.eTZi&&(this.sZUo+=1,this.eTZi=this.yiKD(this.sZUo,this.KfWe.WaXV,this.KfWe.wYWa),this.eTZi&&(this.KfWe.YYzQ=t,e.validate(this.iOKC,this.Pkpz)))}}]),e}(),D=window.ApxorLogger,z=s((function e(){var n=this;a(this,e),u(this,"DcOx",[]),u(this,"_ret_day",{}),u(this,"GIix",{}),u(this,"IJFh",!1),u(this,"kCmf",!1),u(this,"retainedDaysValidated",!0),u(this,"retainedSessionValidated",!0),u(this,"eventDoneInLT",!1),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{n.DcOx=t.overall_cfg.events,n._ret_day=t.overall_cfg.ret_day,n.GIix=t.overall_cfg.session,n.IJFh=t.overall_cfg.toggleRetDay,n.kCmf=t.overall_cfg.toggleSession}catch(t){return D.error(t),!1}return!0})),u(this,"validate",(function(){var e=parseInt(t.getController().getFromStorage("apx_retained_days")),r=parseInt(t.getController().getFromStorage("apx_retained_session"));if(n.IJFh&&!isNaN(e)&&!(e>=n._ret_day.from&&e<=n._ret_day.to))return n.retainedDaysValidated=!1,!1;if(n.kCmf&&!isNaN(r)&&!(r>=n.GIix.from&&r<=n.GIix.to))return n.retainedSessionValidated=!1,!1;try{for(var i=t.getController().getFromStorage("_apx_lt_count"),a=t.getSiteId(),o=JSON.parse((new TextDecoder).decode(function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return e}(_(a,i)))),s=0;s<n.DcOx.length;s++){if(o[n.DcOx[s].name.replace("'","").replace("â€™","")])return n.eventDoneInLT=!0,!1}}catch(t){D.error("Failed to validate the lt count:"+t)}return!0}))})),N=window.ApxorLogger,F=s((function t(){var e=this;a(this,t),u(this,"Scfk",[]),u(this,"kNXD",[]),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.Scfk=t.attributes.user,e.kNXD=t.attributes.session,!Array.isArray(e.Scfk)||!Array.isArray(e.kNXD))return N.error("No attributes"),!1}catch(t){return N.error(t),!1}return!0})),u(this,"validate",(function(t,n){return e.qXuh(t,e.Scfk)&&e.qXuh(n,e.kNXD)})),u(this,"qXuh",(function(t,e){var n=e.length,r=!0;try{for(var i,a=function(){var n=e[o];if(!t[n.name]||!1===r)return{v:!1};var i=n.operator,a=n.type,s=n.value.map((function(t){return"s"===a?t:"l"===a?parseInt(t):"f"===a?parseFloat(t):void 0})),u=(Array.isArray(t[n.name])?t[n.name]:[t[n.name]]).some((function(t){return s.some((function(e){return g(t,e,i)}))}));r=r&&u},o=0;o<n;o++)if(i=a())return i.v}catch(t){N.error(t),r=!1}return r}))})),I=s((function e(){var n=this;a(this,e),u(this,"SILL",t.getController()),u(this,"type",""),u(this,"_duration_seconds",0),u(this,"OUOH",1),u(this,"parse",(function(t){try{var e,r,i;if(n.ZTry=null===(e=t.terminate_info.time_based)||void 0===e?void 0:e.type,n._duration_seconds=null===(r=t.terminate_info)||void 0===r?void 0:r.time_based.duration_seconds,n.OUOH=null===(i=t.terminate_info.time_based)||void 0===i?void 0:i.days,n.kOUp(t._id))return n.SILL.persistTerminationInfoLocally(t._id),!1}catch(t){return!1}return!0})),u(this,"kOUp",(function(t){var e,r=JSON.parse(n.SILL.getFromStorage("apx_termination_ID"));if(!r[t]||null===(e=r[t])||void 0===e||!e.startDate)return!1;var i,a=new Date(r[t].startDate),o=new Date((i=new Date).getMonth()+"/"+i.getDate()+"/"+i.getFullYear()),s=parseInt((o-a)/864e5,10),u=function(){var t=new Date;return{hours:t.getHours(),mins:t.getMinutes()}}(),c=r[t].CTVx;return s===n.OUOH&&u.hours>=c.hours||s>n.OUOH||r[t].goalAcheived}))})),Z=s((function t(){var e=this;a(this,t),u(this,"enable_goal_events",!1),u(this,"attributes",{}),u(this,"VSIZ",new F),u(this,"FYnG",new I),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,r,i;if(e.enable_time_based=null==t||null===(n=t.terminate_info)||void 0===n?void 0:n.enable_time_based,e.enable_time_based&&!e.FYnG.parse(t))return!1;if(e.enable_goal_events=null==t||null===(r=t.terminate_info)||void 0===r?void 0:r.enable_goal_events,e.enable_attributes=null==t||null===(i=t.terminate_info)||void 0===i?void 0:i.enable_attributes,e.enable_attributes&&!e.VSIZ.parse(t.terminate_info))return!1}catch(t){return window.ApxorLogger.error(t),!1}return!0})),u(this,"validate",(function(t,n){return e.VSIZ.validate(t,n)}))})),X=window.ApxorLogger,L=s((function e(){var r=this;a(this,e),u(this,"kTmn",[]),u(this,"iehs",[]),u(this,"iOKC",""),u(this,"YfQQ",new A),u(this,"jTFc",new Q),u(this,"xSgW",new E),u(this,"NwMT",new S),u(this,"nLYQ",new z),u(this,"tEbh",new Z),u(this,"tcMX",!1),u(this,"iWan",[]),u(this,"_variant_code",""),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e;if(!f(t._id))return X.error("No Id"),!1;if(!f(t.enabled)||!t.enabled)return X.error("Not enabled"),!1;if(!(r.YfQQ.parse(t)&&r.xSgW.parse(t)&&r.NwMT.parse(t)&&r.jTFc.parse(t)&&r.nLYQ.parse(t)&&r.tEbh.parse(t)))return!1;if(r._variant_code=r.YfQQ._isExperiment||r.YfQQ._only_context?null===(e=r.YfQQ._attr)||void 0===e?void 0:e.apx_variant_code:"TG",!f(t.conditions)||!Array.isArray(t.conditions))return X.error("No valid conditions",t.conditions),!1;r.iOKC=t._id,r.tcMX=!!f(t.sequence_enabled)&&t.sequence_enabled,r.tcMX&&t.conditions.sort((function(t,e){return t.sequence<e.sequence}));for(var n=t.conditions,i=n.length,a=0;a<i;a++){r.iWan=[];var o=n[a];if("didn't"===o.type){var s,u={trigger_key:o.trigger.details.name,no_kpi_array:null==o||null===(s=o.details)||void 0===s||null===(s=s.additional_info)||void 0===s?void 0:s.nkpi,condition_id:null==o?void 0:o._id,time_bounds:o.time_bounds.upper};r.iWan=[].concat(c(r.iWan),[u])}var l=new k;l.initialize(o,r.iOKC,a,r.tcMX,r.iWan)&&r.kTmn.push(l)}if(r.tEbh.enable_goal_events)for(var v=t.terminate_info.goal_events.events,d=v.length,_=0;_<d;_++){var p=new k;p.initialize(v[_],r.iOKC,_,!0,[],"termination")&&r.iehs.push(p)}return r.kTmn.length>0}catch(t){return X.error(t),!1}})),u(this,"VGgR",(function(t){if(!(t<0))if(r.tcMX){var e=r.kTmn[t];if(f(e)&&e.eTZi){var n=r.kTmn[t-1];if(f(n)&&!n.eTZi)return;var i=r.kTmn[t+1];f(i)?i.vFAI():r.ruZH()}}else r.ruZH()})),u(this,"cnwA",(function(t){t<0||r.onEo()})),u(this,"ruZH",(function(){var e,i,a=t.getController().getUserAttributes(),o=t.getController().getSessionAttributes();if(null!==(e=window.ApxorRTM)&&void 0!==e&&e.isBadgePresent&&null!==(i=window.ApxorRTM)&&void 0!==i&&i.badgesLists.includes(r.iOKC)&&t.getController().isBadgeTriggerSatisfied(r.iOKC)||null==t||t.logEvent("apx_trigger_satisfied",{apx_nudge_type:"SURVEY"===r.YfQQ.ZTry?"survey":"campaign",apx_nudge_id:r.iOKC,apx_nudge_name:r.YfQQ.xugs,apx_variant_code:r.YfQQ._isExperiment||r.YfQQ._only_context?r.YfQQ._attr.apx_variant_code:"TG"}),!r.xSgW.validate()||!r.jTFc.validate(a,o)||!r.nLYQ.validate())return r.nLYQ.retainedDaysValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.YfQQ.ZTry?"survey":"campaign",apx_nudge_id:r.iOKC,apx_nudge_name:r.YfQQ.xugs,apx_variant_code:r.YfQQ._isExperiment||r.YfQQ._only_context?r.YfQQ._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Retained day criteria not met"}),r.nLYQ.retainedSessionValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.YfQQ.ZTry?"survey":"campaign",apx_nudge_id:r.iOKC,apx_nudge_name:r.YfQQ.xugs,apx_variant_code:r.YfQQ._isExperiment||r.YfQQ._only_context?r.YfQQ._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"User session criteria not met"}),r.nLYQ.eventDoneInLT&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.YfQQ.ZTry?"survey":"campaign",apx_nudge_id:r.iOKC,apx_nudge_name:r.YfQQ.xugs,apx_variant_code:r.YfQQ._isExperiment||r.YfQQ._only_context?r.YfQQ._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Event done in life time"})),r.jTFc.userAttributesValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.YfQQ.ZTry?"survey":"campaign",apx_nudge_id:r.iOKC,apx_nudge_name:r.YfQQ.xugs,apx_variant_code:r.YfQQ._isExperiment||r.YfQQ._only_context?r.YfQQ._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"User property filter not met"}),r.jTFc.sessionAttributeValidated||null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.YfQQ.ZTry?"survey":"campaign",apx_nudge_id:r.iOKC,apx_nudge_name:r.YfQQ.xugs,apx_variant_code:r.YfQQ._isExperiment||r.YfQQ._only_context?r.YfQQ._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Session property filter not met"}),r.xSgW._not_in_specified_time&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.YfQQ.ZTry?"survey":"campaign",apx_nudge_id:r.iOKC,apx_nudge_name:r.YfQQ.xugs,apx_variant_code:r.YfQQ._isExperiment||r.YfQQ._only_context?r.YfQQ._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Time limits check failed"})),r.xSgW._not_yet_active&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.YfQQ.ZTry?"survey":"campaign",apx_nudge_id:r.iOKC,apx_nudge_name:r.YfQQ.xugs,apx_variant_code:r.YfQQ._isExperiment||r.YfQQ._only_context?r.YfQQ._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"nudge not yet active"})),void(r.xSgW._nudge_expired&&(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.YfQQ.ZTry?"survey":"campaign",apx_nudge_id:r.iOKC,apx_nudge_name:r.YfQQ.xugs,apx_variant_code:r.YfQQ._isExperiment||r.YfQQ._only_context?r.YfQQ._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"nudge expired"})));for(var s=r.kTmn.length,u=s<1,c="",l=0;l<s;l++){var f=r.kTmn[l],v=f.eTZi;if(""===c.trim())u=v;else switch(c){case"AND":u=u&&v;break;case"OR":u=u||v}c=f.NkOp}if(u){if(console.debug("onCondition satisfied"),!r.NwMT.jNxU(r.iOKC))return console.warn("Maximum limit reached",r.iOKC),void(null==t||t.logEvent("apx_non_eligible_user",{apx_nudge_type:"SURVEY"===r.YfQQ.ZTry?"survey":"campaign",apx_nudge_id:r.iOKC,apx_nudge_name:r.YfQQ.xugs,apx_variant_code:r.YfQQ._isExperiment||r.YfQQ._only_context?r.YfQQ._attr.apx_variant_code:"TG",apx_failure_type:"warn",apx_reason:"Campaign limit reached"}));console.log("Dispatching event",r.YfQQ.ZTry),t.logEvent("apx_context_evaluated",n(n({apx_nudge_type:"SURVEY"===r.YfQQ.ZTry?"survey":"campaign",apx_nudge_id:r.iOKC,apx_nudge_name:r.YfQQ.xugs,apx_variant_code:r.YfQQ._isExperiment||r.YfQQ._only_context?r.YfQQ._attr.apx_variant_code:"TG"},r.YfQQ._attr),{},{message_name:r.YfQQ.xugs,id:r.iOKC})),t.getController().dispatchEvent(r.YfQQ.ZTry,{name:r.YfQQ.ZTry,additional_info:{uuid:r.iOKC,name:r.YfQQ.xugs}})}})),u(this,"onEo",(function(){for(var e=r.iehs.length,i=e<1,a="",o=0;o<e;o++){var s=r.iehs[o],u=s.eTZi;if(""===a.trim())i=u;else switch(a){case"AND":i=i&&u;break;case"OR":i=i||u}a=s.QFSA}i&&(console.log("Dispatching event",r.YfQQ.ZTry),t.getController().persistTerminationInfoLocally(r.iOKC),!0===r.YfQQ._only_context&&t.logEvent("apx_context_evaluated",n(n({},r.YfQQ._attr),{},{message_name:r.YfQQ.xugs,id:r.iOKC})),t.getController().dispatchEvent(r.YfQQ.ZTry,{name:r.YfQQ.ZTry,additional_info:{uuid:r.iOKC,name:r.YfQQ.xugs}}))})),u(this,"validateForTerminationAttributes",(function(){var e=t.getController().getUserAttributes(),n=t.getController().getSessionAttributes();return r.tEbh.validate(e,n)})),u(this,"KkRA",(function(){r.NwMT.KkRA()})),u(this,"getFrequencyCount",(function(){return r.NwMT.getFrequencyCount()})),u(this,"eBCX",(function(){return r.NwMT.mOhO()}))})),B=s((function t(){var e=this;a(this,t),u(this,"AHYK",{}),u(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(f(t)&&f(t.configs)){var n=t.configs;if(!Array.isArray(n))return;n.sort((function(t,e){var n,r;return(null!==(n=t.prio)&&void 0!==n?n:-1)-(null!==(r=e.prio)&&void 0!==r?r:-1)}));for(var r=0;r<n.length;r++){var i=n[r],a=i._id,o=new L;o.parse(i)?e.AHYK[a]=o:console.warn("Failed to parse cfg",a)}}})),u(this,"validate",(function(t,n){e.AHYK[t]&&e.AHYK[t].VGgR(n)})),u(this,"getVariantCode",(function(t){return e.AHYK[t]?e.AHYK[t]._variant_code:""})),u(this,"validateForTermination",(function(t,n){e.AHYK[t]&&e.AHYK[t].cnwA(n)})),u(this,"validateForTerminationAttributes",(function(t){return!!e.AHYK[t]&&e.AHYK[t].validateForTerminationAttributes()})),u(this,"KkRA",(function(t){e.AHYK[t].KkRA()})),u(this,"getFrequencyCount",(function(t){return e.AHYK[t].getFrequencyCount()})),u(this,"resetFrequencyCounts",(function(){var t=e.AHYK;for(var n in t)t[n].eBCX()})),u(this,"vrDp",(function(t){try{if(e.AHYK){var n=e.AHYK[t];if(n&&n.YfQQ)return n.YfQQ}}catch(t){console.log("Error in getting the campaign meta ".concat(t))}return{}}))})),P=window.ApxorLogger,q=s((function e(){var n=this;a(this,e),u(this,"GlzJ",{}),u(this,"xSlo",[]),u(this,"dOOa",!1),u(this,"initialize",(function(){var e=t.getController();e.registerForEvent("APP_EVENT",(function(t){return n.cVKm(t,"AE")})),e.registerForEvent("CLIENT_EVENT",(function(t){return n.cVKm(t,"CE")}))})),u(this,"bGro",(function(){for(var t in n.xSlo)n.vOSN(t.event,t.key,t.type);n.dOOa=!0})),u(this,"QNQr",(function(t,e){var r;"function"==typeof e&&((r=n.GlzJ[t]?n.GlzJ[t]:[]).push(e),n.GlzJ[t]=r,P.debug("Listeners list: ",n.GlzJ))})),u(this,"unregisterFromEvent",(function(t,e){if(n.GlzJ[t]){for(var r=n.GlzJ[t],i=[],a=0;a<r.length;a++){var o=r[a];o!==e&&i.push(o)}n.GlzJ[t]=i}})),u(this,"cVKm",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE",r=e+"___"+t.name;n.vOSN(t,r,e)})),u(this,"vOSN",(function(e,r,i){if(n.dOOa){if(P.debug("Notifying listeners for event: "+e+", "+r,n.GlzJ),n.GlzJ[r])for(var a=n.GlzJ[r],o=t.getController().getSDKRunningTimeInSec(),s=0;s<a.length;s++){(0,a[s])(i,e.name,o,e.additional_info)}}else n.xSlo.push({event:e,key:r,type:i})}))})),R=window.ApxorLogger,U=function(){function e(){var n=this;return a(this,e),u(this,"Smtn",!1),u(this,"vGsO",null),u(this,"POWC",m()),u(this,"lOTy",new q),u(this,"ClfE",t.getSiteId()),u(this,"VQVd",{}),u(this,"getQeState",(function(){try{var e=t.getController().getFromStorage("qe_state");return e?JSON.parse(_(n.ClfE,e)):(n.VQVd={},n.setQeState())}catch(t){return n.VQVd={},n.setQeState()}})),u(this,"setQeState",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{t.getController().persistToStorage("qe_state",n.VQVd,!0)}catch(r){""===e?n.VQVd={}:n.VQVd[e]={SESSION:0,OVERALL:0,DATES:{}},t.getController().persistToStorage("qe_state",n.VQVd,!0)}return n.VQVd})),u(this,"initialize",(function(){n.Smtn||(n.Smtn=!0,n.vGsO=new B,n.lOTy.initialize(),n.VQVd=n.getQeState(),R.info("QE Initialized.."))})),u(this,"parse",(function(t){n.GrSY()?(n.vGsO.parse(t),n.lOTy.bGro()):R.warn("Must call init first. Unable to proceed")})),u(this,"validate",(function(t,e){n.GrSY()&&n.vGsO.validate(t,e)})),u(this,"getVariantCode",(function(t){return n.vGsO.getVariantCode(t)})),u(this,"validateForTermination",(function(t,e){n.GrSY()&&n.vGsO.validateForTermination(t,e)})),u(this,"validateForTerminationAttributes",(function(t,e){return n.vGsO.validateForTerminationAttributes(t,e)})),u(this,"updateCount",(function(t){try{f(n.VQVd[t])||n.createObjConfig(t),n.incrementFrequencies(t),n.setQeState(t),n.vGsO.KkRA(t)}catch(t){console.log("Could not update the count config:".concat(t))}})),u(this,"resetFrequencyCounts",(function(){n.vGsO.resetFrequencyCounts()})),u(this,"getFrequencyCount",(function(t){return n.vGsO.getFrequencyCount(t)})),u(this,"registerForEvent",(function(t,e){n.lOTy.QNQr(t,e)})),u(this,"unregisterFromEvent",(function(t,e){n.lOTy.unregisterFromEvent(t,e)})),u(this,"notifyEventListener",(function(t){n.lOTy.cVKm(t)})),u(this,"fetch",(function(e,n,r,i){t.getController().fetchConfiguration(e,n,r,i)})),u(this,"GrSY",(function(){return n.Smtn})),u(this,"getCampaignMetaFromQueryEngine",(function(t){return n.vGsO.vrDp(t)})),u(this,"Yyxu",(function(){return n.POWC})),e.instance||(e.instance=this),e.instance}return s(e,[{key:"createObjConfig",value:function(t){try{this.VQVd=this.getQeState(),f(this.VQVd[t])||(this.VQVd[t]={SESSION:0,OVERALL:0,DATES:{}},this.POWC&&(this.VQVd[t].DATES[this.POWC]=0),this.setQeState(t))}catch(t){R.error("Can not create the frequency count object:"+t)}}},{key:"incrementFrequencies",value:function(t){this.VQVd=this.getQeState();var e=this.VQVd[t];e.SESSION=e.SESSION+1,e.OVERALL=e.OVERALL+1;var n=m();n===this.POWC&&e.DATES&&e.DATES[n]||(this.POWC=n,e.DATES={},e.DATES[this.POWC]=0),e.DATES[this.POWC]=e.DATES[this.POWC]+1}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();u(U,"instance",void 0),window.ceVersion=151;try{void 0===exports&&null===exports||(exports.default=U,module.exports=exports.default)}catch(t){}return U}));
