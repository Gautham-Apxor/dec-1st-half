!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("apxor")):"function"==typeof define&&define.amd?define(["apxor"],e):(t=t||self)["apxor-qe"]=e(t.Apxor)}(this,(function(t){"use strict";function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function n(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?e(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,h(r.key),r)}}function a(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,n){return(e=h(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function h(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var l=function(t){return void 0!==t&&!function(t){return null===t}(t)},f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function v(t,e){return Array.from(e).map((function(e,n){return String.fromCharCode(e^function(t,e){return t.charCodeAt(Math.floor(e%t.length))}(t,n))})).join("")}var d=function(t,e){return v(t,e=function(t){var e,n,r,i,o,a,s=0,u=[];if(!t)return t;t+="";do{e=(a=f.indexOf(t.charAt(s++))<<18|f.indexOf(t.charAt(s++))<<12|(i=f.indexOf(t.charAt(s++)))<<6|(o=f.indexOf(t.charAt(s++))))>>16&255,n=a>>8&255,r=255&a,u.push(e),64!==i&&(u.push(n),64!==o&&u.push(r))}while(s<t.length);return u}(e))},g=function(t){switch(t){case"app_event":return"AE";case"client_event":return"CE";case"activity_time":case"activity_event":return"AE"}return"Unknown"},p=function(t){return t.toUpperCase()},y=function(t,e,n){switch(n){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;case"NEQ":return t!==e;case"R":return m(e).test(t);default:return!1}},m=function(t){var e=t.replace(/.*\/([gimuy]*)$/,"$1");e===t&&(e="");var n=e?t.replace(new RegExp("^/(.*?)/"+e+"$"),"$1"):t;return new RegExp(n,e)},_=function(){var t=new Date;return t.getDate()+"/"+t.getMonth()+"/"+t.getFullYear()},T=window.ApxorLogger,E=a((function e(){var n=this;i(this,e),s(this,"jmeK","ALL"),s(this,"xleJ",[]),s(this,"fTbd",[]),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(n.jmeK=t.audience.audience_type,n.xleJ=t.audience.attributes.user,n.fTbd=t.audience.attributes.session,!Array.isArray(n.xleJ)||!Array.isArray(n.fTbd))return T.error("No attributes"),!1}catch(t){return T.error(t),!1}return!0})),s(this,"validate",(function(e,r){var i=!0;return"FTU"===n.jmeK&&(i=t.getController().getSessionInfo().is_first_session),i&&n.WytI(e,n.xleJ)&&n.WytI(r,n.fTbd)})),s(this,"WytI",(function(t,e){var n=e.length,r=!0;try{for(var i,o=function(){var n=e[a];if(!t[n.name]||!1===r)return{v:!1};var i=n.operator,o=n.type,s=n.value.map((function(t){return"s"===o?t:"l"===o?parseInt(t):"f"===o?parseFloat(t):void 0})),u=(Array.isArray(t[n.name])?t[n.name]:[t[n.name]]).some((function(t){return s.some((function(e){return y(t,e,i)}))}));r=r&&u},a=0;a<n;a++)if(i=o())return i.v}catch(t){T.error(t),r=!1}return r}))})),b=window.ApxorLogger,w=a((function t(){var e=this;i(this,t),s(this,"mUDX",0),s(this,"BgKc",0),s(this,"Hdcv","SESSION"),s(this,"RTpU",0),s(this,"ARWr",0),s(this,"aVaw",0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.mUDX=t.frequency.count,-1===e.mUDX&&(e.mUDX=1e3),e.aVaw=e.mUDX,e.BgKc=t.frequency.time_interval,e.Hdcv=t.frequency.validity,e.ARWr=t.frequency.ses_lmt,e._dayCount=t.frequency.day_lmt;var n=G.getInstance().getQeState();if(!l(n)||!l(n[t._id]))return!0;if("SESSION"===e.Hdcv){if(e.mUDX=parseInt(e.mUDX)-parseInt(n[t._id].SESSION),e.mUDX<=0)return console.warn("Max count limit reached for session:"+t._id),!1}else{if("OVERALL"!==e.Hdcv)return b.info("Invalid config."),!1;if(e.mUDX=parseInt(e.mUDX)-parseInt(n[t._id].OVERALL),e.mUDX<=0)return console.warn("Max count limit reached for overall:"+t._id),!1}}catch(t){return b.error(t),!1}return!0})),s(this,"vJXB",(function(){e.mUDX=e.mUDX-1})),s(this,"getFrequencyCount",(function(){return e.mUDX})),s(this,"rpRJ",(function(){"SESSION"===e.Hdcv&&(e.mUDX=e.aVaw,b.info("Campaign Limit reset"))})),s(this,"UJdv",(function(t){try{if(e.mUDX<=0)return!1;var n=G.getInstance().getQeState();if(!l(n)||!l(n[t]))return!0;if(0!==e.ARWr)if(parseInt(e.ARWr)-parseInt(n[t].SESSION)<=0)return!1;if(0!==e._dayCount){var r,i=_();if(parseInt(e._dayCount)-parseInt((null===(r=n[t])||void 0===r?void 0:r.DATES[i])||0)<=0)return!1}}catch(t){b.error("Error validating the frequency:"+t)}return!0}))})),I=a((function t(){var e=this;i(this,t),s(this,"PKGI",""),s(this,"jmeK",""),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n;e.PKGI=t.meta.name,e.jmeK=t.meta.type,e._only_context=t.meta.only_context,e._attr=(null===(n=t.meta)||void 0===n?void 0:n.attr)||{}}catch(t){return window.ApxorLogger.error(t),!1}return!0}))})),S=window.ApxorLogger,A=a((function t(){var e=this;i(this,t),s(this,"PCRr",-1),s(this,"MEXI",-1),s(this,"NMkr",-1),s(this,"wdJi",-1),s(this,"dZdr",!1),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(isNaN(Date.parse(t.validity.start_date))||isNaN(Date.parse(t.validity.end_date)))return S.error("Not valid dates"),!1;if(e.PCRr=Date.parse(t.validity.start_date),e.MEXI=Date.parse(t.validity.end_date),l(t.time_limits_in_day)&&(e.dZdr=t.time_limits_in_day,e.dZdr&&l(t.time_limits))){var n=(new Date).toISOString().split("T")[0];if(e.NMkr=Date.parse(n+"T"+t.time_limits.start_time+".000Z"),e.wdJi=Date.parse(n+"T"+t.time_limits.end_time+".000Z"),isNaN(e.NMkr)||isNaN(e.wdJi))return S.error("Not valid times"),!1}}catch(t){return S.error(t),!1}return!0})),s(this,"validate",(function(){var t=Date.now();return t>e.PCRr&&t<e.MEXI&&(!e.dZdr||t>=e.NMkr&&t<=e.wdJi)}))})),x=a((function t(){var e=this;i(this,t),s(this,"PKGI",""),s(this,"IiHv",{}),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{e.PKGI=t.name,e.IiHv=t.additional_info}catch(t){return!1}return!0}))})),D=a((function t(){var e=this;i(this,t),s(this,"TzOD",0),s(this,"bqJO",0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.TzOD=Number(t.lower),e.bqJO=Number(t.upper),isNaN(e.TzOD)||isNaN(e.bqJO))return!1}catch(t){return!1}return!0}))})),K=a((function t(){var e=this;i(this,t),s(this,"syQo",0),s(this,"gRxd",""),s(this,"zHgO",""),s(this,"kMTn",new x),s(this,"eyVh",new D),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.gRxd=t.event_type,e.zHgO=t.activity,e.kMTn.parse(t.details)&&e.eyVh.parse(t.time_bounds)}catch(t){return!1}}))})),O=window.ApxorLogger,k=a((function t(){var e=this;i(this,t),s(this,"syQo",0),s(this,"mpzJ",-1),s(this,"mUDX",0),s(this,"KCBp",""),s(this,"zHgO",""),s(this,"gRxd",""),s(this,"eyVh",new D),s(this,"kMTn",new x),s(this,"zikL",new K),s(this,"PyqI","AND"),s(this,"ZRSg",!1),s(this,"jmeK",void 0),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return e.mpzJ=t.sequence,e.mUDX=t.count_config.count,e.KCBp=t.count_config.operator,e.zHgO=t.activity,e.gRxd=t.event_type,e.PyqI=t.combine_operator,e.jmeK=t.type,e.kMTn.parse(t.details)&&e.zikL.parse(t.trigger)&&e.eyVh.parse(t.time_bounds)}catch(t){return O.error(t),!1}}))})),L=window.ApxorLogger,q=a((function t(){var e=this;i(this,t),s(this,"mUDX",0),s(this,"KCBp",""),s(this,"gRxd",""),s(this,"eyVh",new D),s(this,"kMTn",new x),s(this,"PyqI","AND"),s(this,"parse",(function(t){try{return e.mUDX=t.count_config.count,e.KCBp=t.count_config.operator,e.gRxd=t.event_type,e.PyqI=t.combine_operator,e.kMTn.parse(t.details)&&e.eyVh.parse(t.time_bounds)}catch(t){return L.error(t),!1}}))})),C=window.ApxorLogger,F=function(){function e(){var n=this;i(this,e),s(this,"iXYK",0),s(this,"BfqT",""),s(this,"QhEh",new k),s(this,"iJLT",new q),s(this,"qybS",!1),s(this,"jHTx",!1),s(this,"qwDV",0),s(this,"PyqI","AND"),s(this,"bnPK","OR"),s(this,"BQdN",-1),s(this,"iysy",[]),s(this,"uBcI",{}),s(this,"VPpS",!1),s(this,"initialize",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(n.BfqT=r,n.qwDV=i,n.iysy=a,"termination"===s&&""!==s){n.iJLT.parse(e);return n.bnPK=n.iJLT.PyqI,n.bzVM(),!0}var u=n.QhEh.parse(e);if(u){if(n.PyqI=n.QhEh.PyqI,n.QhEh.ZRSg){var c=n.QhEh.kMTn.PKGI;"APX_PAGE_OPENED"===c&&(c=n.QhEh.kMTn.IiHv.navigation_id,c=l(c)?c:n.QhEh.kMTn.PKGI),n.BQdN=t.getController().getEventCount(c);var h=n.QhEh.mUDX,f=n.QhEh.KCBp;if(n.jHTx=n.dKpu(n.BQdN-1,h,f,!1),n.qybS=n.jHTx,n.jHTx&&"APX_PAGE_OPENED"===n.QhEh.kMTn.PKGI)return!0}return o&&0!==i||n.pAKn(),!0}return!1})),s(this,"pAKn",(function(){var t,e=n.QhEh,r=e.zikL,i=G.getInstance();"app_start"===r.gRxd?(n.qybS=!0,i.registerForEvent(g(e.gRxd)+"___"+e.kMTn.PKGI,n.QwGb)):i.registerForEvent(g(e.gRxd)+"___"+r.kMTn.PKGI,n.QwGb),null!==(t=window.ApxorRTM)&&void 0!==t&&t.badgesLists.includes(n.BfqT)&&i.registerForEvent(g(e.gRxd)+"___"+"apxor-badge-container-".concat("-".concat(n.BfqT).replaceAll(" ","").replace(/[^\w\s]/gi,"")),n.QwGb)})),s(this,"bzVM",(function(){var t=n.iJLT,e=G.getInstance();n.qybS=!0,e.registerForEvent(g(t.gRxd)+"___"+t.kMTn.PKGI,n.EWlF)})),s(this,"sTps",(function(t,e,r,i){var o,a=(Date.now()-n.uBcI[e])/1e3;(null===(o=n.QhEh)||void 0===o||null===(o=o.kMTn)||void 0===o||null===(o=o.IiHv)||void 0===o?void 0:o.time)/1e3>a&&n._displayCampaign(r)})),s(this,"PxvG",(function(t,e,r,i){var o,a;n.VPpS=!0;var s=Date.now(),u=null===(o=n.QhEh)||void 0===o||null===(o=o.zikL)||void 0===o?void 0:o.kMTn.PKGI,c=(s-n.uBcI[u])/1e3,h=null===(a=n.QhEh)||void 0===a||null===(a=a.kMTn)||void 0===a||null===(a=a.IiHv)||void 0===a?void 0:a.time;(h/=1e3)>c&&n._displayCampaign(r)})),s(this,"QwGb",(function(e,r,i,o){var a,s,u=G.getInstance();if(n.qybS){if(null!==(a=window.ApxorRTM)&&void 0!==a&&a.isBadgePresent&&null!==(s=window.ApxorRTM)&&void 0!==s&&s.badgesLists.includes(n.BfqT)&&t.getController().isBadgeTriggerSatisfied(n.BfqT))return n.jHTx=!0,n.QhEh.syQo=i,void u.validate(n.BfqT,n.qwDV);g(n.QhEh.gRxd)===e&&n.tLdK(i-n.QhEh.zikL.syQo,n.QhEh.eyVh)&&n.QhEh.kMTn.PKGI===r&&n.UZXB(n.QhEh.kMTn.IiHv,o)&&(n.iXYK+=1,n.jHTx=n.dKpu(n.iXYK,n.QhEh.mUDX,n.QhEh.KCBp),n.jHTx&&(n.QhEh.syQo=i,u.validate(n.BfqT,n.qwDV)))}else if(n.qybS=n.UXwU(e,r,i,o),n.qybS){var c=n.QhEh,h=c.zikL;if(h.syQo=i,"activity_time"===(null==c?void 0:c.gRxd)){var l,f,v,d=null==c||null===(l=c.kMTn)||void 0===l||null===(l=l.IiHv)||void 0===l?void 0:l.time;(null==c||null===(f=c.kMTn)||void 0===f||null===(f=f.IiHv)||void 0===f?void 0:f.nkpi.length)>0&&(setTimeout((function(){n.VPpS||(n.jHTx=!0,n.jHTx&&(n.iXYK+=1,n.jHTx=n.dKpu(n.iXYK,n.QhEh.mUDX,n.QhEh.KCBp),n.jHTx&&(n.QhEh.syQo=i,u.validate(n.BfqT,n.qwDV)))),c.kMTn.IiHv.nkpi.map((function(t){u.unregisterFromEvent(p(c.kMTn.IiHv.et)+"___"+t,n)}))}),d),c.kMTn.IiHv.nkpi.map((function(t){u.registerForEvent(p(c.kMTn.IiHv.et)+"___"+t,n.PxvG)}))),(null==c||null===(v=c.kMTn)||void 0===v||null===(v=v.IiHv)||void 0===v?void 0:v.kpi.length)>0&&(setTimeout((function(){c.kMTn.IiHv.kpi.map((function(t){u.unregisterFromEvent(p(c.kMTn.IiHv.et)+"___"+t,n)}))}),d),c.kMTn.IiHv.kpi.map((function(t){t===c.zikL.kMTn.PKGI?(u.unregisterFromEvent(g(h.gRxd)+"___"+h.kMTn.PKGI,n),u.registerForEvent(p(c.kMTn.IiHv.et)+"___"+t,n.sTps)):u.registerForEvent(p(c.kMTn.IiHv.et)+"___"+t,n.PxvG)})))}else u.unregisterFromEvent(g(h.gRxd)+"___"+h.kMTn.PKGI,n),u.registerForEvent(g(c.gRxd)+"___"+c.kMTn.PKGI,n);n.uBcI[r]=Date.now()}})),s(this,"EWlF",(function(t,e,r,i){var o=G.getInstance();g(n.iJLT.gRxd)===t&&n.tLdK(r,n.iJLT.eyVh)&&n.iJLT.kMTn.PKGI===e&&n.UZXB(n.iJLT.kMTn.IiHv,i)&&(n.iXYK+=1,n.jHTx=n.dKpu(n.iXYK,n.iJLT.mUDX,n.iJLT.KCBp),n.jHTx&&(n.iJLT.syQo=r,o.validateForTermination(n.BfqT,n.qwDV)))})),s(this,"UXwU",(function(t,e,r,i){var o=n.QhEh.zikL;return g(o.gRxd)===t&&o.kMTn.PKGI===e&&n.tLdK(r,o.eyVh)&&n.UZXB(o.kMTn.IiHv,i)})),s(this,"tLdK",(function(t,e){var n=Math.ceil(t);return n>e.TzOD&&n<e.bqJO})),s(this,"dKpu",(function(t,e,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];switch(i&&n.QhEh.ZRSg&&(t+=n.BQdN),r){case"EQ":return t===e;case"GT":return t>e;case"GTE":return t>=e;case"LT":return t<e;case"LTE":return t<=e;default:return!1}})),s(this,"UZXB",(function(t,e){var n=!0;try{var i,o=function(){if(!e[a]||!1===n)return{v:!1};if("object"===r(t[a])){var i,o=t[a].op,s=t[a].t;"s"===s?i=t[a].val:"l"!==s&&"f"!==s||(i=parseFloat(t[a].val));var u=(Array.isArray(e[a])?e[a]:[e[a]]).some((function(t){return y(t,i,o)}));n=n&&u}else n=n&&y(e[a],t[a],"EQ")};for(var a in t)if(i=o())return i.v}catch(t){C.error(t),n=!1}return n}))}return a(e,[{key:"_displayCampaign",value:function(t){var e=G.getInstance();this.jHTx=!0,this.jHTx&&(this.iXYK+=1,this.jHTx=this.dKpu(this.iXYK,this.QhEh.mUDX,this.QhEh.KCBp),this.jHTx&&(this.QhEh.syQo=t,e.validate(this.BfqT,this.qwDV)))}}]),e}(),M=window.ApxorLogger,Q=a((function e(){var n=this;i(this,e),s(this,"HpLw",[]),s(this,"_ret_day",{}),s(this,"CvdL",{}),s(this,"Xrpn",!1),s(this,"SmPL",!1),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{n.HpLw=t.overall_cfg.events,n._ret_day=t.overall_cfg.ret_day,n.CvdL=t.overall_cfg.session,n.Xrpn=t.overall_cfg.toggleRetDay,n.HpLw=t.overall_cfg.events,n.SmPL=t.overall_cfg.toggleSession}catch(t){return M.error(t),!1}return!0})),s(this,"validate",(function(){var e=parseInt(t.getController().getFromStorage("apx_retained_days")),r=parseInt(t.getController().getFromStorage("apx_retained_session"));if(n.Xrpn&&!isNaN(e)&&!(e>=n._ret_day.from&&e<=n._ret_day.to))return!1;if(n.SmPL&&!isNaN(r)&&!(r>=n.CvdL.from&&r<=n.CvdL.to))return!1;try{for(var i=t.getController().getFromStorage("_apx_lt_count"),o=t.getSiteId(),a=JSON.parse((new TextDecoder).decode(function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return e}(d(o,i)))),s=0;s<n.HpLw.length;s++){if(a[n.HpLw[s].name.replace("'","").replace("â€™","")])return!1}}catch(t){M.error("Failed to validate the lt count:"+t)}return!0}))})),V=window.ApxorLogger,P=a((function t(){var e=this;i(this,t),s(this,"xleJ",[]),s(this,"fTbd",[]),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(e.xleJ=t.attributes.user,e.fTbd=t.attributes.session,!Array.isArray(e.xleJ)||!Array.isArray(e.fTbd))return V.error("No attributes"),!1}catch(t){return V.error(t),!1}return!0})),s(this,"validate",(function(t,n){return e.WytI(t,e.xleJ)&&e.WytI(n,e.fTbd)})),s(this,"WytI",(function(t,e){var n=e.length,r=!0;try{for(var i,o=function(){var n=e[a];if(!t[n.name]||!1===r)return{v:!1};var i=n.operator,o=n.type,s=n.value.map((function(t){return"s"===o?t:"l"===o?parseInt(t):"f"===o?parseFloat(t):void 0})),u=(Array.isArray(t[n.name])?t[n.name]:[t[n.name]]).some((function(t){return s.some((function(e){return y(t,e,i)}))}));r=r&&u},a=0;a<n;a++)if(i=o())return i.v}catch(t){V.error(t),r=!1}return r}))})),j=a((function e(){var n=this;i(this,e),s(this,"dUMb",t.getController()),s(this,"type",""),s(this,"_duration_seconds",0),s(this,"sACU",1),s(this,"parse",(function(t){try{var e,r,i;if(n.jmeK=null===(e=t.terminate_info.time_based)||void 0===e?void 0:e.type,n._duration_seconds=null===(r=t.terminate_info)||void 0===r?void 0:r.time_based.duration_seconds,n.sACU=null===(i=t.terminate_info.time_based)||void 0===i?void 0:i.days,n.VaLh(t._id))return n.dUMb.persistTerminationInfoLocally(t._id),!1}catch(t){return!1}return!0})),s(this,"VaLh",(function(t){var e,r=JSON.parse(n.dUMb.getFromStorage("apx_termination_ID"));if(!r[t]||null===(e=r[t])||void 0===e||!e.startDate)return!1;var i,o=new Date(r[t].startDate),a=new Date((i=new Date).getMonth()+"/"+i.getDate()+"/"+i.getFullYear()),s=parseInt((a-o)/864e5,10),u=function(){var t=new Date;return{hours:t.getHours(),mins:t.getMinutes()}}(),c=r[t].NMkr;return s===n.sACU&&u.hours>=c.hours||s>n.sACU||r[t].goalAcheived}))})),N=a((function t(){var e=this;i(this,t),s(this,"enable_goal_events",!1),s(this,"attributes",{}),s(this,"awLa",new P),s(this,"dQMy",new j),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n,r,i;if(e.enable_time_based=null==t||null===(n=t.terminate_info)||void 0===n?void 0:n.enable_time_based,e.enable_time_based&&!e.dQMy.parse(t))return!1;if(e.enable_goal_events=null==t||null===(r=t.terminate_info)||void 0===r?void 0:r.enable_goal_events,e.enable_attributes=null==t||null===(i=t.terminate_info)||void 0===i?void 0:i.enable_attributes,e.enable_attributes&&!e.awLa.parse(t.terminate_info))return!1}catch(t){return window.ApxorLogger.error(t),!1}return!0})),s(this,"validate",(function(t,n){return e.awLa.validate(t,n)}))})),U=window.ApxorLogger,H=a((function e(){var r=this;i(this,e),s(this,"FusY",[]),s(this,"vhqf",[]),s(this,"BfqT",""),s(this,"VKEY",new I),s(this,"sjYN",new E),s(this,"Hdcv",new A),s(this,"DagU",new w),s(this,"DgBs",new Q),s(this,"ZjVH",new N),s(this,"vaie",!1),s(this,"AQsY",[]),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!l(t._id))return U.error("No Id"),!1;if(!l(t.enabled)||!t.enabled)return U.error("Not enabled"),!1;if(!(r.VKEY.parse(t)&&r.Hdcv.parse(t)&&r.DagU.parse(t)&&r.sjYN.parse(t)&&r.DgBs.parse(t)&&r.ZjVH.parse(t)))return!1;if(!l(t.conditions)||!Array.isArray(t.conditions))return U.error("No valid conditions",t.conditions),!1;r.BfqT=t._id,r.vaie=!!l(t.sequence_enabled)&&t.sequence_enabled,r.vaie&&t.conditions.sort((function(t,e){return t.sequence<e.sequence}));for(var e=t.conditions,n=e.length,i=0;i<n;i++){r.AQsY=[];var o=e[i];if("didn't"===o.type){var a,s={trigger_key:o.trigger.details.name,no_kpi_array:null==o||null===(a=o.details)||void 0===a||null===(a=a.additional_info)||void 0===a?void 0:a.nkpi,condition_id:null==o?void 0:o._id,time_bounds:o.time_bounds.upper};r.AQsY=[].concat(u(r.AQsY),[s])}var c=new F;c.initialize(o,r.BfqT,i,r.vaie,r.AQsY)&&r.FusY.push(c)}if(r.ZjVH.enable_goal_events)for(var h=t.terminate_info.goal_events.events,f=h.length,v=0;v<f;v++){var d=new F;d.initialize(h[v],r.BfqT,v,!0,[],"termination")&&r.vhqf.push(d)}return r.FusY.length>0}catch(t){return U.error(t),!1}})),s(this,"Ebgb",(function(t){if(!(t<0))if(r.vaie){var e=r.FusY[t];if(l(e)&&e.jHTx){var n=r.FusY[t-1];if(l(n)&&!n.jHTx)return;var i=r.FusY[t+1];l(i)?i.pAKn():r.ZDKt()}}else r.ZDKt()})),s(this,"Rpyh",(function(t){t<0||r.bZrH()})),s(this,"ZDKt",(function(){var e=t.getController().getUserAttributes(),i=t.getController().getSessionAttributes();if(r.Hdcv.validate()&&r.sjYN.validate(e,i)&&r.DgBs.validate()){for(var o=r.FusY.length,a=o<1,s="",u=0;u<o;u++){var c=r.FusY[u],h=c.jHTx;if(""===s.trim())a=h;else switch(s){case"AND":a=a&&h;break;case"OR":a=a||h}s=c.PyqI}if(a){if(console.debug("onCondition satisfied"),!r.DagU.UJdv(r.BfqT))return void console.warn("Maximum limit reached",r.BfqT);console.log("Dispatching event",r.VKEY.jmeK),!0===r.VKEY._only_context&&t.logEvent("apx_context_evaluated",n(n({},r.VKEY._attr),{},{message_name:r.VKEY.PKGI,id:r.BfqT})),t.getController().dispatchEvent(r.VKEY.jmeK,{name:r.VKEY.jmeK,additional_info:{uuid:r.BfqT,name:r.VKEY.PKGI}})}}})),s(this,"bZrH",(function(){for(var e=r.vhqf.length,i=e<1,o="",a=0;a<e;a++){var s=r.vhqf[a],u=s.jHTx;if(""===o.trim())i=u;else switch(o){case"AND":i=i&&u;break;case"OR":i=i||u}o=s.bnPK}i&&(console.log("Dispatching event",r.VKEY.jmeK),t.getController().persistTerminationInfoLocally(r.BfqT),!0===r.VKEY._only_context&&t.logEvent("apx_context_evaluated",n(n({},r.VKEY._attr),{},{message_name:r.VKEY.PKGI,id:r.BfqT})),t.getController().dispatchEvent(r.VKEY.jmeK,{name:r.VKEY.jmeK,additional_info:{uuid:r.BfqT,name:r.VKEY.PKGI}}))})),s(this,"validateForTerminationAttributes",(function(){var e=t.getController().getUserAttributes(),n=t.getController().getSessionAttributes();return r.ZjVH.validate(e,n)})),s(this,"vJXB",(function(){r.DagU.vJXB()})),s(this,"getFrequencyCount",(function(){return r.DagU.getFrequencyCount()})),s(this,"tbGX",(function(){return r.DagU.rpRJ()}))})),X=a((function t(){var e=this;i(this,t),s(this,"FEos",{}),s(this,"parse",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{configs:[]};if(l(t)&&l(t.configs)){var n=t.configs;if(!Array.isArray(n))return;n.sort((function(t,e){var n,r;return(null!==(n=t.prio)&&void 0!==n?n:-1)-(null!==(r=e.prio)&&void 0!==r?r:-1)}));for(var r=0;r<n.length;r++){var i=n[r],o=i._id,a=new H;a.parse(i)?e.FEos[o]=a:console.warn("Failed to parse cfg",o)}}})),s(this,"validate",(function(t,n){e.FEos[t]&&e.FEos[t].Ebgb(n)})),s(this,"validateForTermination",(function(t,n){e.FEos[t]&&e.FEos[t].Rpyh(n)})),s(this,"validateForTerminationAttributes",(function(t){return!!e.FEos[t]&&e.FEos[t].validateForTerminationAttributes()})),s(this,"vJXB",(function(t){e.FEos[t].vJXB()})),s(this,"getFrequencyCount",(function(t){return e.FEos[t].getFrequencyCount()})),s(this,"resetFrequencyCounts",(function(){var t=e.FEos;for(var n in t)t[n].tbGX()})),s(this,"YLYH",(function(t){try{if(e.FEos){var n=e.FEos[t];if(n&&n.VKEY)return n.VKEY}}catch(t){console.log("Error in getting the campaign meta ".concat(t))}return{}}))})),B=window.ApxorLogger,R=a((function e(){var n=this;i(this,e),s(this,"kfXU",{}),s(this,"npVN",[]),s(this,"doPc",!1),s(this,"initialize",(function(){var e=t.getController();e.registerForEvent("APP_EVENT",(function(t){return n.OAZv(t,"AE")})),e.registerForEvent("CLIENT_EVENT",(function(t){return n.OAZv(t,"CE")}))})),s(this,"YBLD",(function(){for(var t in n.npVN)n.SFpI(t.event,t.key,t.type);n.doPc=!0})),s(this,"ADBZ",(function(t,e){var r;"function"==typeof e&&((r=n.kfXU[t]?n.kfXU[t]:[]).push(e),n.kfXU[t]=r,B.debug("Listeners list: ",n.kfXU))})),s(this,"unregisterFromEvent",(function(t,e){if(n.kfXU[t]){for(var r=n.kfXU[t],i=[],o=0;o<r.length;o++){var a=r[o];a!==e&&i.push(a)}n.kfXU[t]=i}})),s(this,"OAZv",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"AE",r=e+"___"+t.name;n.SFpI(t,r,e)})),s(this,"SFpI",(function(e,r,i){if(n.doPc){if(B.debug("Notifying listeners for event: "+e+", "+r,n.kfXU),n.kfXU[r])for(var o=n.kfXU[r],a=t.getController().getSDKRunningTimeInSec(),s=0;s<o.length;s++){(0,o[s])(i,e.name,a,e.additional_info)}}else n.npVN.push({event:e,key:r,type:i})}))})),Y=window.ApxorLogger,G=function(){function e(){var n=this;return i(this,e),s(this,"eNvV",!1),s(this,"esSM",null),s(this,"VWGy",_()),s(this,"SCTx",new R),s(this,"Rgxj",t.getSiteId()),s(this,"oOTI",{}),s(this,"getQeState",(function(){try{var e=t.getController().getFromStorage("qe_state");return e?JSON.parse(d(n.Rgxj,e)):(n.oOTI={},n.setQeState())}catch(t){return n.oOTI={},n.setQeState()}})),s(this,"setQeState",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{t.getController().persistToStorage("qe_state",n.oOTI,!0)}catch(r){""===e?n.oOTI={}:n.oOTI[e]={SESSION:0,OVERALL:0,DATES:{}},t.getController().persistToStorage("qe_state",n.oOTI,!0)}return n.oOTI})),s(this,"initialize",(function(){n.eNvV||(n.eNvV=!0,n.esSM=new X,n.SCTx.initialize(),n.oOTI=n.getQeState(),Y.info("QE Initialized.."))})),s(this,"parse",(function(t){n.tSsO()?(n.esSM.parse(t),n.SCTx.YBLD()):Y.warn("Must call init first. Unable to proceed")})),s(this,"validate",(function(t,e){n.tSsO()&&n.esSM.validate(t,e)})),s(this,"validateForTermination",(function(t,e){n.tSsO()&&n.esSM.validateForTermination(t,e)})),s(this,"validateForTerminationAttributes",(function(t,e){return n.esSM.validateForTerminationAttributes(t,e)})),s(this,"updateCount",(function(t){try{l(n.oOTI[t])||n.createObjConfig(t),n.incrementFrequencies(t),n.setQeState(t),n.esSM.vJXB(t)}catch(t){console.log("Could not update the count config:".concat(t))}})),s(this,"resetFrequencyCounts",(function(){n.esSM.resetFrequencyCounts()})),s(this,"getFrequencyCount",(function(t){return n.esSM.getFrequencyCount(t)})),s(this,"registerForEvent",(function(t,e){n.SCTx.ADBZ(t,e)})),s(this,"unregisterFromEvent",(function(t,e){n.SCTx.unregisterFromEvent(t,e)})),s(this,"notifyEventListener",(function(t){n.SCTx.OAZv(t)})),s(this,"fetch",(function(e,n,r,i){t.getController().fetchConfiguration(e,n,r,i)})),s(this,"tSsO",(function(){return n.eNvV})),s(this,"getCampaignMetaFromQueryEngine",(function(t){return n.esSM.YLYH(t)})),s(this,"rQik",(function(){return n.VWGy})),e.instance||(e.instance=this),e.instance}return a(e,[{key:"createObjConfig",value:function(t){try{this.oOTI=this.getQeState(),l(this.oOTI[t])||(this.oOTI[t]={SESSION:0,OVERALL:0,DATES:{}},this.VWGy&&(this.oOTI[t].DATES[this.VWGy]=0),this.setQeState(t))}catch(t){Y.error("Can not create the frequency count object:"+t)}}},{key:"incrementFrequencies",value:function(t){this.oOTI=this.getQeState();var e=this.oOTI[t];e.SESSION=e.SESSION+1,e.OVERALL=e.OVERALL+1;var n=_();n===this.VWGy&&e.DATES&&e.DATES[n]||(this.VWGy=n,e.DATES={},e.DATES[this.VWGy]=0),e.DATES[this.VWGy]=e.DATES[this.VWGy]+1}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();s(G,"instance",void 0),window.ceVersion=142;try{void 0===exports&&null===exports||(exports.default=G,module.exports=exports.default)}catch(t){}return G}));
